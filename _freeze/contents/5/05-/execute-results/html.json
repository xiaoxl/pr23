{
  "hash": "f48d4b5fb7d81251fa9deaf00cf0a093",
  "result": {
    "markdown": "# Visualization\n\n\nThe main reference for this Chapter is @McK2017.\n\n\n\n## `matplotlib.pyplot`\n\n`matplotlib` is a modern and classic plot library. Its main features are inspired by `MATLAB`. In this book we mostly use `pyplot` package from `matplotlib`. We use the following import convention:\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport matplotlib.pyplot as plt\n```\n:::\n\n\n### `matplotlib` interface\n\n\n\n`matplotlib` has two major application interfaces, or styles of using the library:\n\n- An explicit `Axes` interface that uses methods on a `Figure` or `Axes` object to create other Artists, and build a visualization step by step. You may treat this `Figure` object as a canvas, and `Axes` as plots on a canvas. There might be one or more plots on one canvas. This has also been called an *object-oriented* interface.\n- An implicit `pyplot` interface that keeps track of the last `Figure` and `Axes` created, and adds Artists to the object it thinks the user wants.\n\nHere is an example of an explicit interface.\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\nfig = plt.figure()\nax = fig.subplots()\nax.plot([1, 2, 3, 4], [0, 0.5, 1, 0.2])\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-3-output-1.png){width=571 height=404}\n:::\n:::\n\n\nHere is an example of an implicit interface.\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\nplt.plot([1, 2, 3, 4], [0, 0.5, 1, 0.2])\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-4-output-1.png){width=571 height=404}\n:::\n:::\n\n\n::: {.callout-note}\nIf the plot is not shown, you may want to type `plt.show()` to force the plot being rendered. However, to make `plt.show()` work is related to switching `matplotlib` backends, and is sometimes very complicated.\n:::\n\nThe purpose to explicitly use `fig` and `ax` is to have more control over the configurations. The first important configuration is subplots.\n\n- `.subplot()`\n- `.subplots()`\n- `.add_subplot()`\n\nPlease see the following examples.\n\n\n::: {#exm-}\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\nplt.subplot(1, 2, 1)\nplt.plot([1, 2, 3], [0, 0.5, 0.2])\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-5-output-1.png){width=287 height=404}\n:::\n:::\n\n\n:::\n\n\n::: {#exm-}\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\nplt.subplot(1, 2, 1)\nplt.plot([1, 2, 3], [0, 0.5, 0.2])\nplt.subplot(1, 2, 2)\nplt.plot([3, 2, 1], [0, 0.5, 0.2])\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-6-output-1.png){width=571 height=404}\n:::\n:::\n\n\n:::\n\n\n::: {#exm-}\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\nfig, axs = plt.subplots(1, 2)\naxs[0].plot([1, 2, 3], [0, 0.5, 0.2])\naxs[1].plot([3, 2, 1], [0, 0.5, 0.2])\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-7-output-1.png){width=571 height=404}\n:::\n:::\n\n\n:::\n\n\n::: {#exm-}\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\nimport numpy as np\nfig = plt.figure()\nax1 = fig.add_subplot(2, 2, 1)\nax2 = fig.add_subplot(2, 2, 3)\nax3 = fig.add_subplot(1, 2, 2)\n\nax3.plot([1, 2, 3], [0, 0.5, 0.2])\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-8-output-1.png){width=571 height=409}\n:::\n:::\n\n\nThe auguments `2, 2, 1` means that we split the figure into a `2x2` grid and the axis `ax1` is in the 1st position. The rest is understood in the same way.\n:::\n\n\n::: {#exm-}\nIf you don't explicitly initialize `fig` and `ax`, you may use `plt.gcf()` and `plt.gca()` to get the handles for further operations.\n\n::: {.cell execution_count=8}\n``` {.python .cell-code}\nplt.subplot(1, 2, 1)\nax = plt.gca()\nax.plot([1, 2, 3], [0, 0.5, 0.2])\n\nplt.subplot(1, 2, 2)\nax = plt.gca()\nax.plot([3, 2, 1], [0, 0.5, 0.2])\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-9-output-1.png){width=571 height=404}\n:::\n:::\n\n\n:::\n\n\n\nThe purpose to explicitly use `fig` and `ax` is to have more control over the configurations. For example, when generate a `figure` object, we may use `figsize=(3, 3)` as an option to set the figure size to be `3x3`. `dpi` is another commonly modified option.\n\n::: {.cell execution_count=9}\n``` {.python .cell-code}\nfig = plt.figure(figsize=(2, 2), dpi=50)\nplt.plot([1, 2, 3], [0, 0.5, 0.2])\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-10-output-1.png){}\n:::\n:::\n\n\nIf you would like to change this setting later, you may use the following command before plotting. \n\n::: {.cell execution_count=10}\n``` {.python .cell-code}\nfig.set_size_inches(10, 10)\nfig.set_dpi(300)\nplt.plot([1, 2, 3], [0, 0.5, 0.2])\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-11-output-1.png){width=571 height=404}\n:::\n:::\n\n\nYou may use `fig.savefig('filename.png')` to save the image into a file.\n\n\n### Downstream packages\nThere are multiple packages depending on `matplotlib` to provide plotting. For example, you may directly plot from a Pandas DataFrame or a Pandas Series.\n\n::: {#exm-}\n\n::: {.cell execution_count=11}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\ns = pd.Series(np.random.randn(10).cumsum(), index=np.arange(0, 100, 10))\ns.plot()\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```\n<AxesSubplot:>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-12-output-2.png){width=582 height=409}\n:::\n:::\n\n\n::: {.cell execution_count=12}\n``` {.python .cell-code}\ndf = pd.DataFrame(np.random.randn(10, 4).cumsum(0),\n                  columns=['A', 'B', 'C', 'D'],\n                  index=np.arange(0, 100, 10))\ndf.plot()\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n```\n<AxesSubplot:>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-13-output-2.png){width=569 height=404}\n:::\n:::\n\n\n:::\n\n\n### plotting \n#### `plt.plot()`\nThis is the command for line plotting. You may use `linestyle='--'` and `color='g'` to control the line style and color. The style can be shortened as `g--`. \n\nHere is a list of commonly used linestyles and colors.\n\n- line styles\n    - `solid` or `-`\n    - `dashed` or `--`\n    - `dashdot` or `-.`\n    - `dotted` or `:`\n- marker styles\n    - `o` as circle markers\n    - `+` as plusses\n    - `^` as triangles\n    - `s` as squares\n- colors\n    - `b` as blue\n    - `g` as green\n    - `r` as red\n    - `k` as black\n    - `w` as white\n\nThe input of `plt.plot()` is two lists `x` and `y`. If there is only one list inputed, that one will be recognized as `y` and the index of elements of `y` will be used as the dafault `x`.\n\n\n::: {#exm-plot1}\n\n::: {.cell execution_count=13}\n``` {.python .cell-code}\nplt.plot(np.random.randn(30).cumsum(), color='r', linestyle='--', marker='o')\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-14-output-1.png){width=559 height=404}\n:::\n:::\n\n\nYou may compare it with this [Example](#exm-plotwithsns) for the purpose of `seaborn` from next Section.\n:::\n\n#### `plt.bar()` and `plt.barh()`\nThe two commands make vertical and horizontal bar plots, respectively.\n::: {#exm-}\n\n::: {.cell execution_count=14}\n``` {.python .cell-code}\nimport pandas as pd\ndata = pd.Series(np.random.rand(16), index=list('abcdefghijklmnop'))\n\nfig, axes = plt.subplots(2, 1)\naxes[0].bar(x=data.index, height=data, color='k', alpha=0.7)\naxes[1].barh(y=data.index, width=data, color='b', alpha=0.7)\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```\n<BarContainer object of 16 artists>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-15-output-2.png){width=571 height=404}\n:::\n:::\n\n\nWe may also directly plot the bar plot from the Series. \n\n::: {.cell execution_count=15}\n``` {.python .cell-code}\nfig, axes = plt.subplots(2, 1)\ndata.plot.bar(ax=axes[0], color='k', alpha=0.7)\ndata.plot.barh(ax=axes[1], color='b', alpha=0.7)\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```\n<AxesSubplot:>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-16-output-2.png){width=571 height=404}\n:::\n:::\n\n\n:::\n\n\n\nWith a DataFrame, bar plots group the values in each row together in a group in bars. This is easier if we directly plot from the DataFrame.\n\n::: {#exm-}\n\n::: {.cell execution_count=16}\n``` {.python .cell-code}\ndf = pd.DataFrame(np.random.rand(6, 4),\n                  index=['one', 'two', 'three', 'four', 'five', 'six'],\n                  columns=pd.Index(['A', 'B', 'C', 'D'], name='Genus'))\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>Genus</th>\n      <th>A</th>\n      <th>B</th>\n      <th>C</th>\n      <th>D</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>one</th>\n      <td>0.462480</td>\n      <td>0.317290</td>\n      <td>0.135837</td>\n      <td>0.128753</td>\n    </tr>\n    <tr>\n      <th>two</th>\n      <td>0.304087</td>\n      <td>0.890032</td>\n      <td>0.287505</td>\n      <td>0.891993</td>\n    </tr>\n    <tr>\n      <th>three</th>\n      <td>0.107128</td>\n      <td>0.335981</td>\n      <td>0.199633</td>\n      <td>0.244386</td>\n    </tr>\n    <tr>\n      <th>four</th>\n      <td>0.590399</td>\n      <td>0.416214</td>\n      <td>0.890569</td>\n      <td>0.434600</td>\n    </tr>\n    <tr>\n      <th>five</th>\n      <td>0.212786</td>\n      <td>0.748788</td>\n      <td>0.661229</td>\n      <td>0.496709</td>\n    </tr>\n    <tr>\n      <th>six</th>\n      <td>0.520316</td>\n      <td>0.390112</td>\n      <td>0.837196</td>\n      <td>0.609629</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=17}\n``` {.python .cell-code}\ndf.plot.bar()\n```\n\n::: {.cell-output .cell-output-display execution_count=17}\n```\n<AxesSubplot:>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-18-output-2.png){width=571 height=426}\n:::\n:::\n\n\n::: {.cell execution_count=18}\n``` {.python .cell-code}\ndf.plot.barh(stacked=True, alpha=0.5)\n```\n\n::: {.cell-output .cell-output-display execution_count=18}\n```\n<AxesSubplot:>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-19-output-2.png){width=585 height=404}\n:::\n:::\n\n\n:::\n\n#### `plt.scatter()`\n\n\n::: {#exm-}\n\n::: {.cell execution_count=19}\n``` {.python .cell-code}\nimport numpy as np\n\nN = 100\ndata = 0.9 * np.random.rand(N, 2)\narea = (20 * np.random.rand(N))**2 \nc = np.sqrt(area)\nplt.scatter(data[:, 0], data[:, 1], s=area, marker='^', c=c)\n```\n\n::: {.cell-output .cell-output-display execution_count=19}\n```\n<matplotlib.collections.PathCollection at 0x1d0cfb66e80>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-20-output-2.png){width=571 height=404}\n:::\n:::\n\n\n:::\n\n\n#### `plt.hist()`\nHere are two plots with build-in statistics. The plot command will have statistics as outputs. To disable it we could send the outputs to a temporary variable `_`.\n::: {#exm-histogram1}\n\n::: {.cell execution_count=20}\n``` {.python .cell-code}\nmu, sigma = 100, 15\nx = mu + sigma * np.random.randn(10000)\ny = mu-30 + sigma*2 * np.random.randn(10000)\n_ = plt.hist(x, 50, density=True, facecolor='g', alpha=0.75)\n_ = plt.hist(y, 50, density=True, facecolor='r', alpha=0.75)\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-21-output-1.png){width=588 height=404}\n:::\n:::\n\n\n:::\n\n\n### `plt.boxplot()`\n\n::: {#exm-}\n\n::: {.cell execution_count=21}\n``` {.python .cell-code}\nspread = np.random.rand(50) * 100\ncenter = np.ones(30) * 50\nflier_high = np.random.rand(10) * 100 + 100\nflier_low = np.random.rand(10) * -100\ndata = np.concatenate((spread, center, flier_high, flier_low)).reshape(50, 2)\n\n_ = plt.boxplot(data, flierprops={'markerfacecolor': 'g', 'marker': 'D'})\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-22-output-1.png){width=586 height=406}\n:::\n:::\n\n\n:::\n\n### Titles, labels and legends\n\n- Titles\n    - `plt.title(label)`, `plt.xlabel(label)`, `plt.ylabel(label)` will set the title/xlabel/ylabel.\n    - `ax.set_title(label)`, `ax.set_xlabel(label)`, `ax.set_ylabel(label)` will do the same thing.\n- Labels\n    - `plt` methods\n        - `xlim()`, `ylim()`, `xticks()`, `yticks()`, `xticklabels()`, `yticklabels()`\n        - all the above with arguments\n    - `ax` methods\n        - `get_xlim()`, `get_ylim()`, etc..\n        - `set_xlim()`, `set_ylim()`, etc..\n- Legneds\n    - First add `label` option to each piece when plotting, and then add `ax.legends()` or `plt.legends()` at the end to display the legends.\n    - You may use `handles, labels = ax.get_legend_handles_labels()` to get the handles and labels of the legends, and modify them if necessary.\n\n\n::: {#exm-}\n\n::: {.cell execution_count=22}\n``` {.python .cell-code}\nimport numpy as np\nfig, ax = plt.subplots(1, 1)\nax.plot(np.random.randn(1000).cumsum(), 'k', label='one')\nax.plot(np.random.randn(1000).cumsum(), 'r--', label='two')\nax.plot(np.random.randn(1000).cumsum(), 'b.', label='three')\n\nax.set_title('Example')\nax.set_xlabel('x')\nax.set_ylabel('y')\n\nax.set_yticks([-40, 0, 40])\nax.set_yticklabels(['good', 'bad', 'ugly'])\n\nax.legend(loc='best')\n```\n\n::: {.cell-output .cell-output-display execution_count=22}\n```\n<matplotlib.legend.Legend at 0x1d0d0400b50>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-23-output-2.png){width=601 height=442}\n:::\n:::\n\n\n:::\n\n### Annotations\n\n- The command to add simple annotations is `ax.text()`. The required auguments are the coordinates of the text and the text itself. You may add several options to modify the style.\n- If arrows are needed, we may use `ax.annotation()`. Here an arrow will be shown from `xytext` to `xy`. The style of the arrow is controlled by the option `arrowprops`.\n\n\n::: {#exm-}\n\n::: {.cell execution_count=23}\n``` {.python .cell-code}\nfig, ax = plt.subplots(figsize=(5, 5))\nax.plot(np.random.randn(1000).cumsum(), 'k', label='one')\nax.text(500, 0, 'Hello world!', family='monospace', fontsize=15, c='r')\nax.annotate('test', xy=(400, 0), xytext=(400, -10), c='r',\n            arrowprops={'facecolor': 'black',\n                        'shrink': 0.05})\n```\n\n::: {.cell-output .cell-output-display execution_count=23}\n```\nText(400, -10, 'test')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-24-output-2.png){width=429 height=404}\n:::\n:::\n\n\n:::\n\n\n### Example\n\n::: {#exm-}\nThe stock data can be downloaded from [here](assests/datasets/spx.csv). \n\n::: {.cell execution_count=24}\n``` {.python .cell-code}\nfrom datetime import datetime\nfig, ax = plt.subplots()\ndata = pd.read_csv('assests/datasets/spx.csv', index_col=0, parse_dates=True)\nspx = data['SPX']\nspx.plot(ax=ax, style='k-')\ncrisis_data = [(datetime(2007, 10, 11), 'Peak of bull market'),\n               (datetime(2008, 3, 12), 'Bear Stearns Fails'),\n               (datetime(2008, 9, 15), 'Lehman Bankruptcy')]\nfor date, label in crisis_data:\n    ax.annotate(label, xy=(date, spx.asof(date) + 75),\n                xytext=(date, spx.asof(date) + 225),\n                arrowprops=dict(facecolor='black', headwidth=4, width=2,\n                                headlength=4),\n                horizontalalignment='left', verticalalignment='top')\nax.set_xlim(['1/1/2007', '1/1/2011'])\nax.set_ylim([600, 1800])\n_ = ax.set_title('Important dates in the 2008-2009 financial crisis')\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-25-output-1.png){width=595 height=432}\n:::\n:::\n\n\n:::\n\n\n::: {#exm-}\nHere is an example of arrows with different shapes. For more details please read the official [document](https://matplotlib.org/stable/tutorials/text/annotations.html#annotating-with-arrow).\n\n::: {.cell execution_count=25}\n``` {.python .cell-code}\nfig, ax = plt.subplots()\n\nx = np.linspace(0, 20, 1000)\nax.plot(x, np.cos(x))\nax.axis('equal')\n\nax.annotate('local maximum', xy=(6.28, 1), xytext=(10, 4),\n            arrowprops=dict(facecolor='black', shrink=0.05))\n\nax.annotate('local minimum', xy=(5 * np.pi, -1), xytext=(2, -6),\n            arrowprops=dict(arrowstyle=\"->\",\n                            connectionstyle=\"angle3,angleA=0,angleB=-90\",\n                            color='r'))\n```\n\n::: {.cell-output .cell-output-display execution_count=25}\n```\nText(2, -6, 'local minimum')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-26-output-2.png){width=569 height=404}\n:::\n:::\n\n\n:::\n\n\n## `seaborn`\n\nThere are some new libraries built upon `matplotlib`, and `seaborn` is one of them. `seaborn` is for statistical graphics. \n\n`seaborn` is used imported in the following way.\n\n::: {.cell execution_count=26}\n``` {.python .cell-code}\nimport seaborn as sns\n```\n:::\n\n\n\n\n`seaborn` also modifies the default `matplotlib` color schemes and plot styles to improve readability and aesthetics. Even if you do not use the `seaborn` API, you may prefer to import `seaborn` as a simple way to improve the visual aesthetics of general `matplotlib` plots.\n\nTo apply `sns` theme, run the following code.\n\n::: {.cell execution_count=28}\n``` {.python .cell-code}\nsns.set_theme()\n```\n:::\n\n\nLet us directly run a few codes from the last section and compare the differences between them.\n\n\n\n::: {#exm-plotwithsns}\n\n::: {.cell execution_count=29}\n``` {.python .cell-code}\nplt.plot(np.random.randn(30).cumsum(), color='r', linestyle='--', marker='o')\n```\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-30-output-1.png){width=562 height=408}\n:::\n:::\n\n\nPlease compare the output of the same code with [the previous example](#exm-plot1)\n:::\n\n\n### Scatter plots with `relplot()`\n\nThe basic scatter plot method is `scatterplot()`. It is wrapped in `relplot()` as the default plotting method. So here we will mainly talk about `relplot()`. It is named that way because it is designed to visualize many different statistical relationships. \n\nThe idea of `relplot()` is to display points based on the variables `x` and `y` you choose, and assign different properties to alter the apperance of the points. \n\n- `col` will create multiple plots based on the column you choose.\n- `hue` is for color encoding, based on the column you choose.\n- `size` will change the marker area, based on the column you choose.\n- `style` will change the marker symbol, based on the column you choose.\n\n\n::: {#exm-}\nConsider the following example. `tips` is a DataFrame, which is shown below.\n\n::: {.cell execution_count=30}\n``` {.python .cell-code}\nimport seaborn as sns\ntips = sns.load_dataset(\"tips\")\ntips\n```\n\n::: {.cell-output .cell-output-display execution_count=30}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>total_bill</th>\n      <th>tip</th>\n      <th>sex</th>\n      <th>smoker</th>\n      <th>day</th>\n      <th>time</th>\n      <th>size</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>16.99</td>\n      <td>1.01</td>\n      <td>Female</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>10.34</td>\n      <td>1.66</td>\n      <td>Male</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>21.01</td>\n      <td>3.50</td>\n      <td>Male</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>23.68</td>\n      <td>3.31</td>\n      <td>Male</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>24.59</td>\n      <td>3.61</td>\n      <td>Female</td>\n      <td>No</td>\n      <td>Sun</td>\n      <td>Dinner</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>239</th>\n      <td>29.03</td>\n      <td>5.92</td>\n      <td>Male</td>\n      <td>No</td>\n      <td>Sat</td>\n      <td>Dinner</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>240</th>\n      <td>27.18</td>\n      <td>2.00</td>\n      <td>Female</td>\n      <td>Yes</td>\n      <td>Sat</td>\n      <td>Dinner</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>241</th>\n      <td>22.67</td>\n      <td>2.00</td>\n      <td>Male</td>\n      <td>Yes</td>\n      <td>Sat</td>\n      <td>Dinner</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>242</th>\n      <td>17.82</td>\n      <td>1.75</td>\n      <td>Male</td>\n      <td>No</td>\n      <td>Sat</td>\n      <td>Dinner</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>243</th>\n      <td>18.78</td>\n      <td>3.00</td>\n      <td>Female</td>\n      <td>No</td>\n      <td>Thur</td>\n      <td>Dinner</td>\n      <td>2</td>\n    </tr>\n  </tbody>\n</table>\n<p>244 rows × 7 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=31}\n``` {.python .cell-code}\nsns.relplot(data=tips,\n            x=\"total_bill\", y=\"tip\", col=\"time\",\n            hue=\"smoker\", style=\"smoker\", size=\"size\")\n```\n\n::: {.cell-output .cell-output-display execution_count=31}\n```\n<seaborn.axisgrid.FacetGrid at 0x1d0d3dff880>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-32-output-2.png){width=1026 height=464}\n:::\n:::\n\n\n:::\n\nThe default type of plots for `relplot()` is scatter plots. However you may change it to line plot by setting `kind='line'`.\n\n\n::: {#exm-}\n\n::: {.cell execution_count=32}\n``` {.python .cell-code}\ndots = sns.load_dataset(\"dots\")\nsns.relplot(data=dots, kind=\"line\",\n            x=\"time\", y=\"firing_rate\", col=\"align\",\n            hue=\"choice\", size=\"coherence\", style=\"choice\",\n            facet_kws=dict(sharex=False))\n```\n\n::: {.cell-output .cell-output-display execution_count=32}\n```\n<seaborn.axisgrid.FacetGrid at 0x1d0d3c39700>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-33-output-2.png){width=1046 height=464}\n:::\n:::\n\n\n:::\n\n### `regplot()`\nThis method is a combination between scatter plots and linear regression.\n\n::: {#exm-}\nWe still use `tips` as an example.\n\n::: {.cell execution_count=33}\n``` {.python .cell-code}\nsns.regplot(x='total_bill', y='tip', data=tips)\n```\n\n::: {.cell-output .cell-output-display execution_count=33}\n```\n<AxesSubplot:xlabel='total_bill', ylabel='tip'>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-34-output-2.png){width=589 height=428}\n:::\n:::\n\n\n:::\n\n\n### `pairplot()`\nThis is a way to display the pairwise relations among several variables. \n\n::: {#exm-}\nThe following code shows the pairplots among all numeric data in `tips`.\n\n::: {.cell execution_count=34}\n``` {.python .cell-code}\nsns.pairplot(tips, diag_kind='kde', plot_kws={'alpha': 0.2})\n```\n\n::: {.cell-output .cell-output-display execution_count=34}\n```\n<seaborn.axisgrid.PairGrid at 0x1d0d0765ca0>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-35-output-2.png){width=708 height=708}\n:::\n:::\n\n\n:::\n\n\n### `barplot`\n\n\n::: {#exm-}\n\n::: {.cell execution_count=35}\n``` {.python .cell-code}\nsns.barplot(x='total_bill', y='day', data=tips, orient='h')\n```\n\n::: {.cell-output .cell-output-display execution_count=35}\n```\n<AxesSubplot:xlabel='total_bill', ylabel='day'>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-36-output-2.png){width=603 height=428}\n:::\n:::\n\n\nIn the plot, there are several `total_bill` during each `day`. The value in the plot is the average of `total_bill` in each `day`, and the black line stands for the `95%` confidence interval.\n\n::: {.cell execution_count=36}\n``` {.python .cell-code}\nsns.barplot(x='total_bill', y='day', hue='time', data=tips, orient='h')\n```\n\n::: {.cell-output .cell-output-display execution_count=36}\n```\n<AxesSubplot:xlabel='total_bill', ylabel='day'>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-37-output-2.png){width=603 height=428}\n:::\n:::\n\n\nIn this plot, lunch and dinner are distinguished by colors.\n:::\n\n### Histogram\n\n::: {#exm-}\n\n::: {.cell execution_count=37}\n``` {.python .cell-code}\nmu, sigma = 100, 15\nx = mu + sigma * np.random.randn(10000)\ny = mu-30 + sigma*2 * np.random.randn(10000)\ndf = pd.DataFrame(np.array([x,y]).T)\nsns.histplot(df, bins=100, kde=True)\n```\n\n::: {.cell-output .cell-output-display execution_count=37}\n```\n<AxesSubplot:ylabel='Count'>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-38-output-2.png){width=597 height=408}\n:::\n:::\n\n\nPlease compare this plot with [this Example](#exm-histogram1)\n:::\n\n\n## Examples\n\n\n### Example 1: `USA.gov` Data From `Bitly`\nIn 2011, URL shortening service `Bitly` partnered with the US government website\n`USA.gov` to provide a feed of anonymous data gathered from users who shorten links\nending with `.gov` or `.mil`. The data is gotten from @McK2017.\n\nThe data file can be downloaded from [here](assests/datasets/example.txt). The file is mostly in JSON. It can be converted into a DataFrame by the following code.\n\n::: {.cell execution_count=38}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\nimport json\npath = 'assests/datasets/example.txt'\ndf = pd.DataFrame([json.loads(line) for line in open(path)])\n```\n:::\n\n\nWe mainly use `tz` and `a` columns. So let us clean it.\n\n::: {.cell execution_count=39}\n``` {.python .cell-code}\ndf['tz'] = df['tz'].fillna('Missing')\ndf['tz'][df['tz'] == ''] = 'Unknown'\ndf['a'] = df['a'].fillna('Missing')\ndf['a'][df['a'] == ''] = 'Unknown'\n```\n:::\n\n\nWe first want to extract the timezone infomation from it. The timezone info is in the column `tz`.\n\n::: {.cell execution_count=40}\n``` {.python .cell-code}\ntzone = df['tz']\ntvc = tzone.value_counts()\ntvc\n```\n\n::: {.cell-output .cell-output-display execution_count=40}\n```\nAmerica/New_York        1251\nUnknown                  521\nAmerica/Chicago          400\nAmerica/Los_Angeles      382\nAmerica/Denver           191\n                        ... \nEurope/Uzhgorod            1\nAustralia/Queensland       1\nEurope/Sofia               1\nAmerica/Costa_Rica         1\nAmerica/Tegucigalpa        1\nName: tz, Length: 98, dtype: int64\n```\n:::\n:::\n\n\nAfter cleaning data, we would like to visulize the value counts.\n\n::: {.cell execution_count=41}\n``` {.python .cell-code}\nimport seaborn as sns\nsns.barplot(x=tvc[:10].values, y=tvc[:10].index)\n```\n\n::: {.cell-output .cell-output-display execution_count=41}\n```\n<AxesSubplot:>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-42-output-2.png){width=696 height=408}\n:::\n:::\n\n\nWe then would like to extract information from the column `a`. This column is about the agent of the connection. The important info is the part before the space `' '`.\n\n::: {.cell execution_count=42}\n``` {.python .cell-code}\nagent = df['a']\nagent = agent.str.split(' ').str[0]\navc = agent.value_counts()\navc[:10]\n```\n\n::: {.cell-output .cell-output-display execution_count=42}\n```\nMozilla/5.0                 2594\nMozilla/4.0                  601\nGoogleMaps/RochesterNY       121\nMissing                      120\nOpera/9.80                    34\nTEST_INTERNET_AGENT           24\nGoogleProducer                21\nMozilla/6.0                    5\nBlackBerry8520/5.0.0.681       4\nBlackBerry8520/5.0.0.592       3\nName: a, dtype: int64\n```\n:::\n:::\n\n\nNow let us assume that, if `Windows` appears in column `a` the user is using `Windows` os, if not then not. In this case, the os can be detected by the following code.\n\n::: {.cell execution_count=43}\n``` {.python .cell-code}\ndf['os'] = np.where(df['a'].str.contains('Windows'), 'Windows', 'Not Windows')\n```\n:::\n\n\nNow we can make a bar plot about the counts based on `os` and `timezone`.\n\n::: {.cell execution_count=44}\n``` {.python .cell-code}\ntz_os_counts = df.groupby(['tz', 'os']).size().unstack().fillna(0)\ntz_os_counts.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=44}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>os</th>\n      <th>Not Windows</th>\n      <th>Windows</th>\n    </tr>\n    <tr>\n      <th>tz</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Africa/Cairo</th>\n      <td>0.0</td>\n      <td>3.0</td>\n    </tr>\n    <tr>\n      <th>Africa/Casablanca</th>\n      <td>0.0</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>Africa/Ceuta</th>\n      <td>0.0</td>\n      <td>2.0</td>\n    </tr>\n    <tr>\n      <th>Africa/Johannesburg</th>\n      <td>0.0</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>Africa/Lusaka</th>\n      <td>0.0</td>\n      <td>1.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nWe then turn it into a DataFrame using the `.stack()`, `.unstack()` tricks.\n\n::: {.cell execution_count=45}\n``` {.python .cell-code}\ntovc = tz_os_counts.stack()[tz_os_counts.sum(axis=1).nlargest(10).index]\ntovc.name = 'count'\ndftovc = pd.DataFrame(tovc).reset_index()\n```\n:::\n\n\nFinally we may draw the bar plot.\n\n::: {.cell execution_count=46}\n``` {.python .cell-code}\nsns.barplot(x='count', y='tz', hue='os', data=dftovc)\n```\n\n::: {.cell-output .cell-output-display execution_count=46}\n```\n<AxesSubplot:xlabel='count', ylabel='tz'>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-47-output-2.png){width=716 height=428}\n:::\n:::\n\n\n### Example 2: US Baby Names 1880–2010\nThe United States Social Security Administration (SSA) has made available data on the frequency of baby names from 1880 through the present. Hadley Wickham, an author of several popular R packages, has often made use of this dataset in illustrating data manipulation in `R`. The dataset can be downloaded from [here](assests/datasets/babynames.zip) as a zip file. Please unzip it and put it in your working folder.\n\nIn the folder there are 131 `.txt` files. The naming scheme is `yob` + the year. Each file contains 3 columns: `name`, `gender`, and `counts`. We would like to add a column `year`, and combine all files into a single DataFrame. In our example, the year is from 1880 to 2010.\n\n::: {.cell execution_count=47}\n``` {.python .cell-code}\nimport pandas as pd\n\npath = 'assests/datasets/babynames/'\ndflist = list()\nfor year in range(1880, 2011):\n    filename = path + 'yob' + str(year) + '.txt'\n    df = pd.read_csv(filename, names=['name', 'gender', 'counts'])\n    df['year'] = year\n    dflist.append(df)\ndf = pd.concat(dflist, ignore_index=True)\n```\n:::\n\n\nWe can plot the total births by sex and year.\n\n::: {.cell execution_count=48}\n``` {.python .cell-code}\nimport seaborn as sns\n\nsns.relplot(data=df.groupby(['gender', 'year']).sum().reset_index(),\n            x='year', y='counts', hue='gender', kind='line')\n```\n:::\n\n\n::: {.cell execution_count=49}\n\n::: {.cell-output .cell-output-display execution_count=47}\n```\n<seaborn.axisgrid.FacetGrid at 0x1d0d5b9f640>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-50-output-2.png){width=530 height=464}\n:::\n:::\n\n\nFor further analysis, we would like to compute the proportions of each name relative to the total number of births per year per gender. \n\n::: {.cell execution_count=50}\n``` {.python .cell-code}\ndef add_prop(group):\n    group['prop'] = group.counts / group.counts.sum()\n    return group\n\ndf = df.groupby(['gender', 'year']).apply(add_prop)\ndf.head()\n```\n:::\n\n\n::: {.cell execution_count=51}\n\n::: {.cell-output .cell-output-display execution_count=48}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>name</th>\n      <th>gender</th>\n      <th>counts</th>\n      <th>year</th>\n      <th>prop</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>Mary</td>\n      <td>F</td>\n      <td>7065</td>\n      <td>1880</td>\n      <td>0.077643</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>Anna</td>\n      <td>F</td>\n      <td>2604</td>\n      <td>1880</td>\n      <td>0.028618</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>Emma</td>\n      <td>F</td>\n      <td>2003</td>\n      <td>1880</td>\n      <td>0.022013</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>Elizabeth</td>\n      <td>F</td>\n      <td>1939</td>\n      <td>1880</td>\n      <td>0.021309</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>Minnie</td>\n      <td>F</td>\n      <td>1746</td>\n      <td>1880</td>\n      <td>0.019188</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nNow we would like to keep the first 100 names in each year, and save it as a new DataFrame `top100`.\n\n::: {.cell execution_count=52}\n``` {.python .cell-code}\ntop100 = (\n    df.groupby(['year', 'gender'])\n    .apply(lambda x: df.loc[x['counts'].nlargest(100).index])\n    .drop(columns=['year', 'gender'])\n    .reset_index()\n    .drop(columns='level_2')\n)\ntop100.head()\n```\n:::\n\n\n::: {.cell execution_count=53}\n\n::: {.cell-output .cell-output-display execution_count=49}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>year</th>\n      <th>gender</th>\n      <th>name</th>\n      <th>counts</th>\n      <th>prop</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1880</td>\n      <td>F</td>\n      <td>Mary</td>\n      <td>7065</td>\n      <td>0.077643</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1880</td>\n      <td>F</td>\n      <td>Anna</td>\n      <td>2604</td>\n      <td>0.028618</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1880</td>\n      <td>F</td>\n      <td>Emma</td>\n      <td>2003</td>\n      <td>0.022013</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1880</td>\n      <td>F</td>\n      <td>Elizabeth</td>\n      <td>1939</td>\n      <td>0.021309</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1880</td>\n      <td>F</td>\n      <td>Minnie</td>\n      <td>1746</td>\n      <td>0.019188</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nNote that `level_2` is related to the original index after `reset_index()`. That's why we don't need it here.\n\nNow we would like to draw the trend of some names.\n\n::: {.cell execution_count=54}\n``` {.python .cell-code}\nnamelist = ['John', 'Harry', 'Mary']\nsns.relplot(data=top100[top100['name'].isin(namelist)],\n            x='year', y='counts', hue='name', kind='line')\n```\n:::\n\n\n::: {.cell execution_count=55}\n\n::: {.cell-output .cell-output-display execution_count=50}\n```\n<seaborn.axisgrid.FacetGrid at 0x1d0d6f72880>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-56-output-2.png){width=546 height=464}\n:::\n:::\n\n\nNow we would like to analyze the ending of names.\n\n::: {.cell execution_count=56}\n``` {.python .cell-code}\ndf['ending'] = df['name'].str[-1]\nendingcount = df.groupby(['gender', 'year', 'ending']).sum().reset_index()\n```\n:::\n\n\nWe would like to draw barplots to show the distributions in year 1910, 1960 and 2010.\n\n::: {.cell execution_count=57}\n``` {.python .cell-code}\ncertainyear = endingcount[endingcount['year'].isin([1910, 1960, 2010])]\nimport matplotlib.pyplot as plt\n\nfig, axs = plt.subplots(2, 1, figsize=(10,7))\nsns.barplot(data=certainyear[endingcount['gender']=='M'],\n            x='ending', y='prop', hue='year', ax=axs[0])\nsns.barplot(data=certainyear[endingcount['gender']=='F'],\n            x='ending', y='prop', hue='year', ax=axs[1]).legend_.remove()\n```\n:::\n\n\n::: {.cell execution_count=58}\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-59-output-1.png){width=816 height=573}\n:::\n:::\n\n\nWe would also like to draw the line plot to show the trending of certain letters through years.\n\n::: {.cell execution_count=59}\n``` {.python .cell-code}\nsns.relplot(data=endingcount[endingcount.ending.isin(['d', 'n', 'y'])],\n            x='year', y='prop', hue='ending', kind='line')\n```\n:::\n\n\n::: {.cell execution_count=60}\n\n::: {.cell-output .cell-output-display execution_count=52}\n```\n<seaborn.axisgrid.FacetGrid at 0x1d0d7297df0>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](05-_files/figure-html/cell-61-output-2.png){width=525 height=464}\n:::\n:::\n\n\n## Exercises\n\n\n\n::: {#exr-}\nPlease download the `mtcars` file from [here](assests/datasets/mtcars.csv) and read it as a DataFrame. Then create a scatter plot of the `drat` and `wt` variables from `mtcars` and color the dots by the `carb` variable. \n:::\n\n\n::: {#exr-}\nPlease consider the baby name dataset. Please draw the trends of counts of names ending in `a`, `e`, `n` across years for each gender.\n:::\n\n## Projects\n\n\n\n::: {#exr-}\nPlease read the file as a DataFrame from [here](assests/datasets/QSR.csv). This is the Dining satisfaction with quick service restaurants questionare data provided by Dr. Siri McDowall, supported by DART SEED grant.\n\n1. Please pick out all rating columns. Excluding `last.visit`, `visit.again` and `recommend`, compute the mean of the rest and add it to the DataFrame as a new column.\n2. Use a plot to show the relations among these four columns:  `last.visit`, `visit.again`, `recommend` and `mean`.\n3. Look at the column `Profession`. Keep `Student`, and change everything else to be `Professional`, and add it as a new column `Status` to the DataFrame.\n4. Draw the histogram of `mean` with respect to `Status`.\n5. Find the counts of each `recommend` rating for each `Status` and draw the barplot. Do the same to `last.visit`/`Status` and `visit.again`/`Status`.\n6. Exploer the dataset and draw one plot.\n:::\n\n\n\n::: {#exr-}\nPlease use the baby name dataset. We would like to consider the diversity of the names. Please compute the number of popular names in top 50% for each year each gender. Draw a line plot to show the trend and discuss the result.\n:::\n\n",
    "supporting": [
      "05-_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}