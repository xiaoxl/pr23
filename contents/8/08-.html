<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.262">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python/R for Data Science - 8&nbsp; R for Data Sciences</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../contents/references.html" rel="next">
<link href="../../contents/7/07-.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Python/R for Data Science</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">R for Data Sciences</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">Part I: Python</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/1/01-.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preliminaries</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/2/02-.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Python Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/3/03-.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Package: <code>numpy</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/4/04-.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Package: <code>pandas</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/5/05-.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/6/06-.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Classes/Packages for Python</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Part II: R</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/7/07-.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">R Fundamentals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/8/08-.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">R for Data Sciences</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">Appendices</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/app/setup.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Setup</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/app/path.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title"><code>PATH</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/app/virtenv.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Virtual environments</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#tibble" id="toc-tibble" class="nav-link active" data-scroll-target="#tibble"><span class="toc-section-number">8.1</span>  <code>tibble</code></a>
  <ul class="collapse">
  <li><a href="#create-tibbles" id="toc-create-tibbles" class="nav-link" data-scroll-target="#create-tibbles"><span class="toc-section-number">8.1.1</span>  Create tibbles</a></li>
  <li><a href="#differences-between-tibble-and-data.frame." id="toc-differences-between-tibble-and-data.frame." class="nav-link" data-scroll-target="#differences-between-tibble-and-data.frame."><span class="toc-section-number">8.1.2</span>  Differences between tibble and data.frame.</a></li>
  <li><a href="#symbol" id="toc-symbol" class="nav-link" data-scroll-target="#symbol"><span class="toc-section-number">8.1.3</span>  <code>%&gt;%</code> symbol</a></li>
  </ul></li>
  <li><a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data"><span class="toc-section-number">8.2</span>  Tidy Data</a>
  <ul class="collapse">
  <li><a href="#tidying-datasets" id="toc-tidying-datasets" class="nav-link" data-scroll-target="#tidying-datasets"><span class="toc-section-number">8.2.1</span>  Tidying datasets</a></li>
  </ul></li>
  <li><a href="#dplyr" id="toc-dplyr" class="nav-link" data-scroll-target="#dplyr"><span class="toc-section-number">8.3</span>  <code>dplyr</code></a>
  <ul class="collapse">
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><span class="toc-section-number">8.3.1</span>  <code>filter()</code></a></li>
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"><span class="toc-section-number">8.3.2</span>  <code>select()</code></a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><span class="toc-section-number">8.3.3</span>  <code>mutate()</code></a></li>
  <li><a href="#summarize-and-group_by" id="toc-summarize-and-group_by" class="nav-link" data-scroll-target="#summarize-and-group_by"><span class="toc-section-number">8.3.4</span>  <code>summarize()</code> and <code>group_by()</code></a></li>
  </ul></li>
  <li><a href="#ggplot2" id="toc-ggplot2" class="nav-link" data-scroll-target="#ggplot2"><span class="toc-section-number">8.4</span>  <code>ggplot2</code></a>
  <ul class="collapse">
  <li><a href="#aesthetic-mappings" id="toc-aesthetic-mappings" class="nav-link" data-scroll-target="#aesthetic-mappings"><span class="toc-section-number">8.4.1</span>  Aesthetic mappings</a></li>
  <li><a href="#facet" id="toc-facet" class="nav-link" data-scroll-target="#facet"><span class="toc-section-number">8.4.2</span>  <code>facet</code></a></li>
  <li><a href="#geom-objects" id="toc-geom-objects" class="nav-link" data-scroll-target="#geom-objects"><span class="toc-section-number">8.4.3</span>  <code>geom</code> objects</a></li>
  </ul></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="toc-section-number">8.5</span>  Examples</a>
  <ul class="collapse">
  <li><a href="#who-tb-dataset" id="toc-who-tb-dataset" class="nav-link" data-scroll-target="#who-tb-dataset"><span class="toc-section-number">8.5.1</span>  WHO TB dataset</a></li>
  <li><a href="#us-babynames" id="toc-us-babynames" class="nav-link" data-scroll-target="#us-babynames"><span class="toc-section-number">8.5.2</span>  US Babynames</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="toc-section-number">8.6</span>  Exercises</a></li>
  <li><a href="#projects" id="toc-projects" class="nav-link" data-scroll-target="#projects"><span class="toc-section-number">8.7</span>  Projects</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">R for Data Sciences</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The main reference for this Chapter is <span class="citation" data-cites="Wic2017">[<a href="../references.html#ref-Wic2017" role="doc-biblioref">1</a>]</span>.</p>
<section id="tibble" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="tibble"><span class="header-section-number">8.1</span> <code>tibble</code></h2>
<p><code>tidyverse</code> mainly deals with <code>tibble</code> instead of <code>data.frame</code>. Therefore this is where we start.</p>
<p><code>tibble</code> is a <code>data.frame</code> with different attributes and requirements. The package <code>tibble</code> provides support for <code>tibble</code>. It is included in <code>tidyverse</code>. To load it, you just use the code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">#&gt; ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#&gt; ✔ ggplot2 3.3.6     ✔ purrr   0.3.4</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#&gt; ✔ tibble  3.1.7     ✔ dplyr   1.0.9</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#&gt; ✔ tidyr   1.2.0     ✔ stringr 1.4.0</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">#&gt; ✔ readr   2.1.2     ✔ forcats 0.5.1</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="create-tibbles" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1" class="anchored" data-anchor-id="create-tibbles"><span class="header-section-number">8.1.1</span> Create tibbles</h3>
<p>Here is an example of creating tibbles.</p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.1 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">y=</span><span class="dv">1</span>, <span class="at">z=</span>x<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>y)</span>
<span id="cb2-2"><a href="#cb2-2"></a>tbl</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt;       x     y     z</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt; 1     1     1     2</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; 2     2     1     5</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt; 3     3     1    10</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt; 4     4     1    17</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt; 5     5     1    26</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="fu">attributes</span>(tbl)</span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt; $class</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">#&gt; </span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">#&gt; $row.names</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">#&gt; [1] 1 2 3 4 5</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">#&gt; </span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">#&gt; $names</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">#&gt; [1] "x" "y" "z"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that it is more flexible to create a tibble since <code>tibble()</code> will automatically recycle inputs and allows you to refer to variables that you just created.</p>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the past (for a very long time), when using <code>data.frame()</code> to create a <code>data.frame</code>, it will automatically convert strings to factors. This is changed recently that the default setting is not to convert.</p>
<p>When using <code>tibble()</code> to create a <code>tibble</code>, the type of the inputs will never be changed.</p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In <code>tibble</code> you may use <em>nonsyntactic</em> names as column names, which are invalid R variable names. To refer to these variables, you need to surround them with backticks `.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>tb <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-2"><a href="#cb3-2"></a>    <span class="st">`</span><span class="at">:)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"smile"</span>,</span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="st">`</span><span class="at"> </span><span class="st">`</span> <span class="ot">=</span> <span class="st">"space"</span>,</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="st">`</span><span class="at">2000</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"number"</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>)</span>
<span id="cb3-6"><a href="#cb3-6"></a>tb</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt;   `:)`  ` `   `2000`</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; </span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt; 1 smile space number</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="differences-between-tibble-and-data.frame." class="level3" data-number="8.1.2">
<h3 data-number="8.1.2" class="anchored" data-anchor-id="differences-between-tibble-and-data.frame."><span class="header-section-number">8.1.2</span> Differences between tibble and data.frame.</h3>
<section id="printing" class="level4" data-number="8.1.2.1">
<h4 data-number="8.1.2.1" class="anchored" data-anchor-id="printing"><span class="header-section-number">8.1.2.1</span> Printing</h4>
<p>Tibbles have a refined print method that shows only the first 10 rows and all the columns that fit on screen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>deck <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">suit=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'spades'</span>, <span class="st">'hearts'</span>, <span class="st">'clubs'</span>, <span class="st">'diamonds'</span>), <span class="dv">13</span>), <span class="at">face=</span><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>, <span class="dv">4</span>))</span>
<span id="cb4-2"><a href="#cb4-2"></a>deck</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt; # A tibble: 52 × 2</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt;    suit      face</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt;    &lt;chr&gt;    &lt;int&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt;  1 spades       1</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt;  2 hearts       2</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt;  3 clubs        3</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt;  4 diamonds     4</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt;  5 spades       5</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt;  6 hearts       6</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt;  7 clubs        7</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt;  8 diamonds     8</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt;  9 spades       9</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt; 10 hearts      10</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt; # … with 42 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="subsetting" class="level4" data-number="8.1.2.2">
<h4 data-number="8.1.2.2" class="anchored" data-anchor-id="subsetting"><span class="header-section-number">8.1.2.2</span> Subsetting</h4>
<p>To get a single value, <code>[[]]</code> or <code>$</code> should be used, just like for <code>data.frame</code>. These two are almost the same. The only difference is that <code>[[]]</code> accepts positions, but <code>$</code> only accepts names.</p>
<p>To be used in a pipe, the special placeholder <code>.</code> will be used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>deck <span class="sc">%&gt;%</span> .<span class="sc">$</span>face</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13  1  2  3  4  5  6  7  8  9 10 11 12</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#&gt; [26] 13  1  2  3  4  5  6  7  8  9 10 11 12 13  1  2  3  4  5  6  7  8  9 10 11</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">#&gt; [51] 12 13</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will talk about pipes later.</p>
</section>
</section>
<section id="symbol" class="level3" data-number="8.1.3">
<h3 data-number="8.1.3" class="anchored" data-anchor-id="symbol"><span class="header-section-number">8.1.3</span> <code>%&gt;%</code> symbol</h3>
<p><code>%&gt;%</code> is the pipeline symbol, which is another way to connect several functions. Most functions in tidyverse have the first argument <code>data</code>, and both the input <code>data</code> and the output are tibbles. The syntax here is that <code>data %&gt;% function(arguments)</code> is the same as <code>function(data, arguments)</code>. The benefit is that it is easier to have many functions consecutively applied to the data. Please see the following example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">function1</span>(arguments1)</span>
<span id="cb6-2"><a href="#cb6-2"></a>    <span class="sc">%&gt;%</span> <span class="fu">function2</span>(arguments2)</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="sc">%&gt;%</span> <span class="fu">function3</span>(arguments3)</span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="sc">%&gt;%</span> <span class="fu">function4</span>(arguments4)</span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="fu">function4</span>(<span class="fu">function3</span>(<span class="fu">function2</span>(<span class="fu">function1</span>(data, arguments1), arguments2), arguments3), arguments4)</span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a>data2 <span class="ot">&lt;-</span> <span class="fu">function1</span>(data, arguments1)</span>
<span id="cb6-9"><a href="#cb6-9"></a>data3 <span class="ot">&lt;-</span> <span class="fu">function2</span>(data2, arguments2)</span>
<span id="cb6-10"><a href="#cb6-10"></a>data4 <span class="ot">&lt;-</span> <span class="fu">function3</span>(data3, arguments3)</span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="fu">function4</span>(data4, arguments4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The readability of the first one is much better than the second one. Comparing to the third one, we don’t need to create a lot of intermedia temporary variables.</p>
</section>
</section>
<section id="tidy-data" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="tidy-data"><span class="header-section-number">8.2</span> Tidy Data</h2>
<p>The same underlying data can be represented in multiple ways. The following example shows the same data organized in four different ways.</p>
<div id="exm-tidydatasets" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.2 </strong></span>These tibbles are provided by <code>tidyr</code>. You could directly load it from <code>tidyverse</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">data</span>(table1, <span class="at">package=</span><span class="st">'tidyr'</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="fu">data</span>(table2, <span class="at">package=</span><span class="st">'tidyr'</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="fu">data</span>(table3, <span class="at">package=</span><span class="st">'tidyr'</span>)</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="fu">data</span>(table4a, <span class="at">package=</span><span class="st">'tidyr'</span>)</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="fu">data</span>(table4b, <span class="at">package=</span><span class="st">'tidyr'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><code>table1</code></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>table1</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">#&gt;   country      year  cases population</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">#&gt; 1 Afghanistan  1999    745   19987071</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">#&gt; 2 Afghanistan  2000   2666   20595360</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt; 3 Brazil       1999  37737  172006362</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt; 4 Brazil       2000  80488  174504898</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt; 5 China        1999 212258 1272915272</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt; 6 China        2000 213766 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li><code>table2</code></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>table2</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co">#&gt; # A tibble: 12 × 4</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">#&gt;    country      year type            count</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt;  1 Afghanistan  1999 cases             745</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt;  2 Afghanistan  1999 population   19987071</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt;  3 Afghanistan  2000 cases            2666</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt;  4 Afghanistan  2000 population   20595360</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt;  5 Brazil       1999 cases           37737</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt;  6 Brazil       1999 population  172006362</span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt;  7 Brazil       2000 cases           80488</span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">#&gt;  8 Brazil       2000 population  174504898</span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co">#&gt;  9 China        1999 cases          212258</span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">#&gt; 10 China        1999 population 1272915272</span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="co">#&gt; 11 China        2000 cases          213766</span></span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="co">#&gt; 12 China        2000 population 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li><code>table3</code></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>table3</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co">#&gt;   country      year rate             </span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">#&gt; * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            </span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">#&gt; 1 Afghanistan  1999 745/19987071     </span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co">#&gt; 2 Afghanistan  2000 2666/20595360    </span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="co">#&gt; 3 Brazil       1999 37737/172006362  </span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co">#&gt; 4 Brazil       2000 80488/174504898  </span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">#&gt; 5 China        1999 212258/1272915272</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co">#&gt; 6 China        2000 213766/1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Spread across two tibbles.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>table4a</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">#&gt;   country     `1999` `2000`</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">#&gt; * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#&gt; 1 Afghanistan    745   2666</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">#&gt; 2 Brazil       37737  80488</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#&gt; 3 China       212258 213766</span></span>
<span id="cb11-8"><a href="#cb11-8"></a></span>
<span id="cb11-9"><a href="#cb11-9"></a>table4b</span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#&gt;   country         `1999`     `2000`</span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">#&gt; * &lt;chr&gt;            &lt;int&gt;      &lt;int&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">#&gt; 1 Afghanistan   19987071   20595360</span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">#&gt; 2 Brazil       172006362  174504898</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co">#&gt; 3 China       1272915272 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="def-" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 8.1 </strong></span>A dataset is <em>tidy</em> if</p>
<ol type="1">
<li>Each variable have its own column.</li>
<li>Each observation have its own row.</li>
<li>Each value have its oven cell.</li>
</ol>
</div>
<p>These three conditions are interrelated because it is impossible to only satisfy two of the three. In pratical, we need to follow the instructions:</p>
<ol type="1">
<li>Put each dataset in a tibble.</li>
<li>Put each variable in a column.</li>
</ol>
<p><em>Tidy</em> data is a consistent way to organize your data in R. The main advantages are:</p>
<ol type="1">
<li>It is one consistent way of storing data. In other words, this is a consistent data structure that can be used in many cases.</li>
<li>To placing variables in columns allows R’s vectorized nature to shine.</li>
</ol>
<p>All packages in the tidyverse are designed to work with tidy data.</p>
<section id="tidying-datasets" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="tidying-datasets"><span class="header-section-number">8.2.1</span> Tidying datasets</h3>
<p>Most datasets are untidy:</p>
<ul>
<li>One variable might be spread across multiple columns.</li>
<li>One observation might be scattered across multiple rows.</li>
</ul>
<section id="pivot_longer" class="level4" data-number="8.2.1.1">
<h4 data-number="8.2.1.1" class="anchored" data-anchor-id="pivot_longer"><span class="header-section-number">8.2.1.1</span> <code>pivot_longer()</code></h4>
<p>A common problem is that the column names are not names of variables, but values of a variable. For example, <code>table4a</code> above has columns <code>1999</code> and <code>2000</code>. These two names are actually the values of a variable <code>year</code>. In addition, each row represents two observations, not one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>table4a</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co">#&gt;   country     `1999` `2000`</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">#&gt; * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co">#&gt; 1 Afghanistan    745   2666</span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co">#&gt; 2 Brazil       37737  80488</span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">#&gt; 3 China       212258 213766</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To tidy this type of dataset, we need to gather those columns into a new pair of variables. We need three parameters:</p>
<ul>
<li>The set of columns that represent values. In this case, those are <code>1999</code> and <code>2000</code>.</li>
<li>The name of the variable. In this case, it is <code>year</code>. -The name of the variable whose values are spread over the cells. In this case, it is the number of <code>cases</code>.</li>
</ul>
<p>Then we apply <code>pivot_longer()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">pivot_longer</span>(table4a, <span class="at">cols=</span><span class="fu">c</span>(<span class="st">`</span><span class="at">1999</span><span class="st">`</span>, <span class="st">`</span><span class="at">2000</span><span class="st">`</span>), <span class="at">names_to=</span><span class="st">'year'</span>, <span class="at">values_to=</span><span class="st">'cases'</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co">#&gt;   country     year   cases</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co">#&gt; 1 Afghanistan 1999     745</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co">#&gt; 2 Afghanistan 2000    2666</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co">#&gt; 3 Brazil      1999   37737</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co">#&gt; 4 Brazil      2000   80488</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">#&gt; 5 China       1999  212258</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co">#&gt; 6 China       2000  213766</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We may also use the pipe <code>%&gt;%</code> symbol.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>table4a <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(<span class="st">`</span><span class="at">1999</span><span class="st">`</span>, <span class="st">`</span><span class="at">2000</span><span class="st">`</span>), <span class="at">names_to=</span><span class="st">'year'</span>, <span class="at">values_to=</span><span class="st">'cases'</span>)</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co">#&gt;   country     year   cases</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co">#&gt; 1 Afghanistan 1999     745</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co">#&gt; 2 Afghanistan 2000    2666</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co">#&gt; 3 Brazil      1999   37737</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co">#&gt; 4 Brazil      2000   80488</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co">#&gt; 5 China       1999  212258</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co">#&gt; 6 China       2000  213766</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can do the similar thing to <code>table4b</code>. Then we could combine the two tibbles together.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>tidy4a <span class="ot">&lt;-</span> table4a <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(<span class="st">`</span><span class="at">1999</span><span class="st">`</span>, <span class="st">`</span><span class="at">2000</span><span class="st">`</span>), <span class="at">names_to=</span><span class="st">'year'</span>, <span class="at">values_to=</span><span class="st">'cases'</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a>tidy4b <span class="ot">&lt;-</span> table4b <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(<span class="st">`</span><span class="at">1999</span><span class="st">`</span>, <span class="st">`</span><span class="at">2000</span><span class="st">`</span>), <span class="at">names_to=</span><span class="st">'year'</span>, <span class="at">values_to=</span><span class="st">'population'</span>)</span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="fu">left_join</span>(tidy4a, tidy4b)</span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">#&gt; Joining, by = c("country", "year")</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="co">#&gt;   country     year   cases population</span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;      &lt;int&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="co">#&gt; 1 Afghanistan 1999     745   19987071</span></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="co">#&gt; 2 Afghanistan 2000    2666   20595360</span></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co">#&gt; 3 Brazil      1999   37737  172006362</span></span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="co">#&gt; 4 Brazil      2000   80488  174504898</span></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="co">#&gt; 5 China       1999  212258 1272915272</span></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="co">#&gt; 6 China       2000  213766 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>pivot_longer()</code> is an updated approach to <code>gather()</code>, designed to be both simpler to use and to handle more use cases. We recommend you use <code>pivot_longer()</code> for new code; <code>gather()</code> isn’t going away but is no longer under active development.</p>
</section>
<section id="pivot_wider" class="level4" data-number="8.2.1.2">
<h4 data-number="8.2.1.2" class="anchored" data-anchor-id="pivot_wider"><span class="header-section-number">8.2.1.2</span> <code>pivot_wider()</code></h4>
<p>Another issuse is that an observation is scattered across multiple rows. Take <code>table2</code> as an example. An observation is a country in a year, but each observation is spread across two rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>table2</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co">#&gt; # A tibble: 12 × 4</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="co">#&gt;    country      year type            count</span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">#&gt;  1 Afghanistan  1999 cases             745</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co">#&gt;  2 Afghanistan  1999 population   19987071</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co">#&gt;  3 Afghanistan  2000 cases            2666</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="co">#&gt;  4 Afghanistan  2000 population   20595360</span></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="co">#&gt;  5 Brazil       1999 cases           37737</span></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="co">#&gt;  6 Brazil       1999 population  172006362</span></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co">#&gt;  7 Brazil       2000 cases           80488</span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="co">#&gt;  8 Brazil       2000 population  174504898</span></span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="co">#&gt;  9 China        1999 cases          212258</span></span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="co">#&gt; 10 China        1999 population 1272915272</span></span>
<span id="cb16-15"><a href="#cb16-15"></a><span class="co">#&gt; 11 China        2000 cases          213766</span></span>
<span id="cb16-16"><a href="#cb16-16"></a><span class="co">#&gt; 12 China        2000 population 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could apply <code>pivot_wider()</code> to make it tidy. Here we need two arguments.</p>
<ul>
<li>The column that contains variable names. Here, it’s <code>type</code>.</li>
<li>The column that contains values forms multiple variables. Here, it’s <code>count</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">pivot_wider</span>(table2, <span class="at">names_from=</span><span class="st">'type'</span>, <span class="at">values_from=</span><span class="st">'count'</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co">#&gt;   country      year  cases population</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co">#&gt; 1 Afghanistan  1999    745   19987071</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="co">#&gt; 2 Afghanistan  2000   2666   20595360</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co">#&gt; 3 Brazil       1999  37737  172006362</span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="co">#&gt; 4 Brazil       2000  80488  174504898</span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="co">#&gt; 5 China        1999 212258 1272915272</span></span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="co">#&gt; 6 China        2000 213766 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also use the pipe symbol <code>%&gt;%</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>table2 <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from=</span><span class="st">'type'</span>, <span class="at">values_from=</span><span class="st">'count'</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co">#&gt;   country      year  cases population</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co">#&gt; 1 Afghanistan  1999    745   19987071</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="co">#&gt; 2 Afghanistan  2000   2666   20595360</span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co">#&gt; 3 Brazil       1999  37737  172006362</span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co">#&gt; 4 Brazil       2000  80488  174504898</span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="co">#&gt; 5 China        1999 212258 1272915272</span></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="co">#&gt; 6 China        2000 213766 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>pivot_wider()</code> is an updated approach to <code>spread()</code>, designed to be both simpler to use and to handle more use cases. We recommend you use <code>pivot_wider()</code> for new code; <code>spread()</code> isn’t going away but is no longer under active development.</p>
</section>
<section id="separate" class="level4" data-number="8.2.1.3">
<h4 data-number="8.2.1.3" class="anchored" data-anchor-id="separate"><span class="header-section-number">8.2.1.3</span> <code>separate()</code></h4>
<p>If we would like to split one columns into multiple columns since there are more than one values in a cell, we could use <code>separate()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">separate</span>(table3, rate, <span class="at">into=</span><span class="fu">c</span>(<span class="st">'cases'</span>, <span class="st">'population'</span>))</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="co">#&gt;   country      year cases  population</span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     </span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="co">#&gt; 1 Afghanistan  1999 745    19987071  </span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co">#&gt; 2 Afghanistan  2000 2666   20595360  </span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="co">#&gt; 3 Brazil       1999 37737  172006362 </span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co">#&gt; 4 Brazil       2000 80488  174504898 </span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="co">#&gt; 5 China        1999 212258 1272915272</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="co">#&gt; 6 China        2000 213766 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could also use the pipe symbol <code>%&gt;%</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>table3 <span class="sc">%&gt;%</span> <span class="fu">separate</span>(rate, <span class="at">into=</span><span class="fu">c</span>(<span class="st">'cases'</span>, <span class="st">'population'</span>))</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="co">#&gt;   country      year cases  population</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     </span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="co">#&gt; 1 Afghanistan  1999 745    19987071  </span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="co">#&gt; 2 Afghanistan  2000 2666   20595360  </span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="co">#&gt; 3 Brazil       1999 37737  172006362 </span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="co">#&gt; 4 Brazil       2000 80488  174504898 </span></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="co">#&gt; 5 China        1999 212258 1272915272</span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="co">#&gt; 6 China        2000 213766 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using separate, the first argument is the column to be separated. <code>into</code> is where you store the parsed data. If no arguments are given, <code>separate()</code> will split values wherever it sees a non-alphanumeric character. If you would like to specify a separator, you may use the <code>sep</code> argument.</p>
<ul>
<li>If <code>sep</code> is set to be a character, the column will be separated by the character.</li>
<li>If <code>sep</code> is set to be a vector of integers, the column will be separated by the positions.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">separate</span>(table3, rate, <span class="at">into=</span><span class="fu">c</span>(<span class="st">'cases'</span>, <span class="st">'population'</span>), <span class="at">sep=</span><span class="st">'/'</span>)</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co">#&gt;   country      year cases  population</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     </span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co">#&gt; 1 Afghanistan  1999 745    19987071  </span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="co">#&gt; 2 Afghanistan  2000 2666   20595360  </span></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="co">#&gt; 3 Brazil       1999 37737  172006362 </span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="co">#&gt; 4 Brazil       2000 80488  174504898 </span></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="co">#&gt; 5 China        1999 212258 1272915272</span></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="co">#&gt; 6 China        2000 213766 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">separate</span>(table3, rate, <span class="at">into=</span><span class="fu">c</span>(<span class="st">'cases'</span>, <span class="st">'population'</span>), <span class="at">sep=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>))</span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co">#&gt;   country      year cases population</span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     </span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co">#&gt; 1 Afghanistan  1999 74    5/1       </span></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="co">#&gt; 2 Afghanistan  2000 26    66/       </span></span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="co">#&gt; 3 Brazil       1999 37    737       </span></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="co">#&gt; 4 Brazil       2000 80    488       </span></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="co">#&gt; 5 China        1999 21    225       </span></span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="co">#&gt; 6 China        2000 21    376</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that in this example, since <code>into</code> only has two columns, the rest of the data are lost.</p>
<p>Another useful argument is <code>convert</code>. After separation, the columns are still character columns. If we set <code>convert=TRUE</code>, the columns will be automatically converted into better types if possible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">separate</span>(table3, rate, <span class="at">into=</span><span class="fu">c</span>(<span class="st">'cases'</span>, <span class="st">'population'</span>), <span class="at">convert=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="co">#&gt;   country      year  cases population</span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;</span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="co">#&gt; 1 Afghanistan  1999    745   19987071</span></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="co">#&gt; 2 Afghanistan  2000   2666   20595360</span></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="co">#&gt; 3 Brazil       1999  37737  172006362</span></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="co">#&gt; 4 Brazil       2000  80488  174504898</span></span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="co">#&gt; 5 China        1999 212258 1272915272</span></span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="co">#&gt; 6 China        2000 213766 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="unite" class="level4" data-number="8.2.1.4">
<h4 data-number="8.2.1.4" class="anchored" data-anchor-id="unite"><span class="header-section-number">8.2.1.4</span> <code>unite()</code></h4>
<p><code>unite()</code> is the inverse of <code>separate()</code>. The syntax is straghtforward. The default separator is <code>_</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>table3 <span class="sc">%&gt;%</span> <span class="fu">unite</span>(new, year, rate, <span class="at">sep=</span><span class="st">'_'</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="co">#&gt;   country     new                   </span></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;                 </span></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="co">#&gt; 1 Afghanistan 1999_745/19987071     </span></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="co">#&gt; 2 Afghanistan 2000_2666/20595360    </span></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="co">#&gt; 3 Brazil      1999_37737/172006362  </span></span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="co">#&gt; 4 Brazil      2000_80488/174504898  </span></span>
<span id="cb24-9"><a href="#cb24-9"></a><span class="co">#&gt; 5 China       1999_212258/1272915272</span></span>
<span id="cb24-10"><a href="#cb24-10"></a><span class="co">#&gt; 6 China       2000_213766/1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="dplyr" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="dplyr"><span class="header-section-number">8.3</span> <code>dplyr</code></h2>
<p><code>dplyr</code> is a package used to manipulate data. Here we will just introduce the most basic functions. We will use <code>nycflights13::flights</code> as the example. This dataset comes from the US Bureau of Transportation Statistics. The document can be found <a href="https://github.com/tidyverse/nycflights13">here</a>.</p>
<p>To load the dataset, please use the following code.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb25-2"><a href="#cb25-2"></a>flights</span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="co">#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="co">#&gt;  1  2013     1     1      517            515         2      830            819</span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="co">#&gt;  2  2013     1     1      533            529         4      850            830</span></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="co">#&gt;  3  2013     1     1      542            540         2      923            850</span></span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="co">#&gt;  4  2013     1     1      544            545        -1     1004           1022</span></span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="co">#&gt;  5  2013     1     1      554            600        -6      812            837</span></span>
<span id="cb25-11"><a href="#cb25-11"></a><span class="co">#&gt;  6  2013     1     1      554            558        -4      740            728</span></span>
<span id="cb25-12"><a href="#cb25-12"></a><span class="co">#&gt;  7  2013     1     1      555            600        -5      913            854</span></span>
<span id="cb25-13"><a href="#cb25-13"></a><span class="co">#&gt;  8  2013     1     1      557            600        -3      709            723</span></span>
<span id="cb25-14"><a href="#cb25-14"></a><span class="co">#&gt;  9  2013     1     1      557            600        -3      838            846</span></span>
<span id="cb25-15"><a href="#cb25-15"></a><span class="co">#&gt; 10  2013     1     1      558            600        -2      753            745</span></span>
<span id="cb25-16"><a href="#cb25-16"></a><span class="co">#&gt; # … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,</span></span>
<span id="cb25-17"><a href="#cb25-17"></a><span class="co">#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span></span>
<span id="cb25-18"><a href="#cb25-18"></a><span class="co">#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="filter" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="filter"><span class="header-section-number">8.3.1</span> <code>filter()</code></h3>
<p><code>filter()</code> allows you to subset observations based on their values. The first argument is the name of the tibble. The rest are the expressions that filter the data. Please see the following examples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">filter</span>(month<span class="sc">==</span><span class="dv">1</span>, day<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="co">#&gt; # A tibble: 842 × 19</span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="co">#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="co">#&gt;  1  2013     1     1      517            515         2      830            819</span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co">#&gt;  2  2013     1     1      533            529         4      850            830</span></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="co">#&gt;  3  2013     1     1      542            540         2      923            850</span></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="co">#&gt;  4  2013     1     1      544            545        -1     1004           1022</span></span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="co">#&gt;  5  2013     1     1      554            600        -6      812            837</span></span>
<span id="cb26-10"><a href="#cb26-10"></a><span class="co">#&gt;  6  2013     1     1      554            558        -4      740            728</span></span>
<span id="cb26-11"><a href="#cb26-11"></a><span class="co">#&gt;  7  2013     1     1      555            600        -5      913            854</span></span>
<span id="cb26-12"><a href="#cb26-12"></a><span class="co">#&gt;  8  2013     1     1      557            600        -3      709            723</span></span>
<span id="cb26-13"><a href="#cb26-13"></a><span class="co">#&gt;  9  2013     1     1      557            600        -3      838            846</span></span>
<span id="cb26-14"><a href="#cb26-14"></a><span class="co">#&gt; 10  2013     1     1      558            600        -2      753            745</span></span>
<span id="cb26-15"><a href="#cb26-15"></a><span class="co">#&gt; # … with 832 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,</span></span>
<span id="cb26-16"><a href="#cb26-16"></a><span class="co">#&gt; #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span></span>
<span id="cb26-17"><a href="#cb26-17"></a><span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="select" class="level3" data-number="8.3.2">
<h3 data-number="8.3.2" class="anchored" data-anchor-id="select"><span class="header-section-number">8.3.2</span> <code>select()</code></h3>
<p><code>select()</code> allows you to filter columns. It is very similar to slicing <code>[]</code>.</p>
</section>
<section id="mutate" class="level3" data-number="8.3.3">
<h3 data-number="8.3.3" class="anchored" data-anchor-id="mutate"><span class="header-section-number">8.3.3</span> <code>mutate()</code></h3>
<p><code>mutate()</code> is used to add new columns that are functions of existing columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">gain=</span>arr_delay<span class="sc">-</span>dep_delay, <span class="at">hours=</span>air_time<span class="sc">/</span><span class="dv">60</span>, <span class="at">gain_per_hour=</span>gain<span class="sc">/</span>hours)</span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="co">#&gt; # A tibble: 336,776 × 22</span></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="co">#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="co">#&gt;  1  2013     1     1      517            515         2      830            819</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="co">#&gt;  2  2013     1     1      533            529         4      850            830</span></span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="co">#&gt;  3  2013     1     1      542            540         2      923            850</span></span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="co">#&gt;  4  2013     1     1      544            545        -1     1004           1022</span></span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="co">#&gt;  5  2013     1     1      554            600        -6      812            837</span></span>
<span id="cb27-10"><a href="#cb27-10"></a><span class="co">#&gt;  6  2013     1     1      554            558        -4      740            728</span></span>
<span id="cb27-11"><a href="#cb27-11"></a><span class="co">#&gt;  7  2013     1     1      555            600        -5      913            854</span></span>
<span id="cb27-12"><a href="#cb27-12"></a><span class="co">#&gt;  8  2013     1     1      557            600        -3      709            723</span></span>
<span id="cb27-13"><a href="#cb27-13"></a><span class="co">#&gt;  9  2013     1     1      557            600        -3      838            846</span></span>
<span id="cb27-14"><a href="#cb27-14"></a><span class="co">#&gt; 10  2013     1     1      558            600        -2      753            745</span></span>
<span id="cb27-15"><a href="#cb27-15"></a><span class="co">#&gt; # … with 336,766 more rows, and 14 more variables: arr_delay &lt;dbl&gt;,</span></span>
<span id="cb27-16"><a href="#cb27-16"></a><span class="co">#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span></span>
<span id="cb27-17"><a href="#cb27-17"></a><span class="co">#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,</span></span>
<span id="cb27-18"><a href="#cb27-18"></a><span class="co">#&gt; #   gain &lt;dbl&gt;, hours &lt;dbl&gt;, gain_per_hour &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you only want to see the new columns, <code>transmute()</code> can be used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(<span class="at">gain=</span>arr_delay<span class="sc">-</span>dep_delay, <span class="at">hours=</span>air_time<span class="sc">/</span><span class="dv">60</span>, <span class="at">gain_per_hour=</span>gain<span class="sc">/</span>hours)</span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="co">#&gt; # A tibble: 336,776 × 3</span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="co">#&gt;     gain hours gain_per_hour</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="co">#&gt;  1     9 3.78           2.38</span></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="co">#&gt;  2    16 3.78           4.23</span></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="co">#&gt;  3    31 2.67          11.6 </span></span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="co">#&gt;  4   -17 3.05          -5.57</span></span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="co">#&gt;  5   -19 1.93          -9.83</span></span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="co">#&gt;  6    16 2.5            6.4 </span></span>
<span id="cb28-11"><a href="#cb28-11"></a><span class="co">#&gt;  7    24 2.63           9.11</span></span>
<span id="cb28-12"><a href="#cb28-12"></a><span class="co">#&gt;  8   -11 0.883        -12.5 </span></span>
<span id="cb28-13"><a href="#cb28-13"></a><span class="co">#&gt;  9    -5 2.33          -2.14</span></span>
<span id="cb28-14"><a href="#cb28-14"></a><span class="co">#&gt; 10    10 2.3            4.35</span></span>
<span id="cb28-15"><a href="#cb28-15"></a><span class="co">#&gt; # … with 336,766 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here are an (incomplete) list of supported operators and functions.</p>
<ul>
<li>Arithmetic operators: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>.</li>
<li>Modular arithmetic: <code>%/%</code> (integer division), <code>%%</code> (remainder).</li>
<li>Logs: <code>log()</code>, <code>log2()</code>, <code>log10()</code>.</li>
<li>Cumulative and rolling aggregates: <code>cumsum()</code>, <code>cumprod()</code>, <code>cummin()</code>, <code>cummax()</code>, <code>cummean()</code></li>
<li>Logical comparisons: <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>!=</code>.</li>
</ul>
</section>
<section id="summarize-and-group_by" class="level3" data-number="8.3.4">
<h3 data-number="8.3.4" class="anchored" data-anchor-id="summarize-and-group_by"><span class="header-section-number">8.3.4</span> <code>summarize()</code> and <code>group_by()</code></h3>
<p><code>summarize()</code> collapses a dataset to a single row. It computes values across all rows. It is usually paired with <code>group_by()</code>. Here are some examples.</p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.3 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2"></a>    <span class="fu">summarize</span>(<span class="at">delay=</span><span class="fu">mean</span>(dep_delay, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="co">#&gt; `summarise()` has grouped output by 'year', 'month'. You can override using the</span></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="co">#&gt; `.groups` argument.</span></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="co">#&gt; # A tibble: 365 × 4</span></span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="co">#&gt; # Groups:   year, month [12]</span></span>
<span id="cb29-7"><a href="#cb29-7"></a><span class="co">#&gt;     year month   day delay</span></span>
<span id="cb29-8"><a href="#cb29-8"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="co">#&gt;  1  2013     1     1 11.5 </span></span>
<span id="cb29-10"><a href="#cb29-10"></a><span class="co">#&gt;  2  2013     1     2 13.9 </span></span>
<span id="cb29-11"><a href="#cb29-11"></a><span class="co">#&gt;  3  2013     1     3 11.0 </span></span>
<span id="cb29-12"><a href="#cb29-12"></a><span class="co">#&gt;  4  2013     1     4  8.95</span></span>
<span id="cb29-13"><a href="#cb29-13"></a><span class="co">#&gt;  5  2013     1     5  5.73</span></span>
<span id="cb29-14"><a href="#cb29-14"></a><span class="co">#&gt;  6  2013     1     6  7.15</span></span>
<span id="cb29-15"><a href="#cb29-15"></a><span class="co">#&gt;  7  2013     1     7  5.42</span></span>
<span id="cb29-16"><a href="#cb29-16"></a><span class="co">#&gt;  8  2013     1     8  2.55</span></span>
<span id="cb29-17"><a href="#cb29-17"></a><span class="co">#&gt;  9  2013     1     9  2.28</span></span>
<span id="cb29-18"><a href="#cb29-18"></a><span class="co">#&gt; 10  2013     1    10  2.84</span></span>
<span id="cb29-19"><a href="#cb29-19"></a><span class="co">#&gt; # … with 355 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.4 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>delays <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>    <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3"></a>    <span class="fu">summarize</span>(</span>
<span id="cb30-4"><a href="#cb30-4"></a>        <span class="at">count=</span><span class="fu">n</span>(), </span>
<span id="cb30-5"><a href="#cb30-5"></a>        <span class="at">dist=</span><span class="fu">mean</span>(distance, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb30-6"><a href="#cb30-6"></a>        <span class="at">delay=</span><span class="fu">mean</span>(arr_delay, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb30-7"><a href="#cb30-7"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-8"><a href="#cb30-8"></a>    <span class="fu">filter</span>(count<span class="sc">&gt;</span><span class="dv">20</span>, dest<span class="sc">!=</span><span class="st">'HNL'</span>)</span>
<span id="cb30-9"><a href="#cb30-9"></a>delays</span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="co">#&gt; # A tibble: 96 × 4</span></span>
<span id="cb30-11"><a href="#cb30-11"></a><span class="co">#&gt;    dest  count  dist delay</span></span>
<span id="cb30-12"><a href="#cb30-12"></a><span class="co">#&gt;    &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb30-13"><a href="#cb30-13"></a><span class="co">#&gt;  1 ABQ     254 1826   4.38</span></span>
<span id="cb30-14"><a href="#cb30-14"></a><span class="co">#&gt;  2 ACK     265  199   4.85</span></span>
<span id="cb30-15"><a href="#cb30-15"></a><span class="co">#&gt;  3 ALB     439  143  14.4 </span></span>
<span id="cb30-16"><a href="#cb30-16"></a><span class="co">#&gt;  4 ATL   17215  757. 11.3 </span></span>
<span id="cb30-17"><a href="#cb30-17"></a><span class="co">#&gt;  5 AUS    2439 1514.  6.02</span></span>
<span id="cb30-18"><a href="#cb30-18"></a><span class="co">#&gt;  6 AVL     275  584.  8.00</span></span>
<span id="cb30-19"><a href="#cb30-19"></a><span class="co">#&gt;  7 BDL     443  116   7.05</span></span>
<span id="cb30-20"><a href="#cb30-20"></a><span class="co">#&gt;  8 BGR     375  378   8.03</span></span>
<span id="cb30-21"><a href="#cb30-21"></a><span class="co">#&gt;  9 BHM     297  866. 16.9 </span></span>
<span id="cb30-22"><a href="#cb30-22"></a><span class="co">#&gt; 10 BNA    6333  758. 11.8 </span></span>
<span id="cb30-23"><a href="#cb30-23"></a><span class="co">#&gt; # … with 86 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><code>group_by()</code> can also be used together with <code>mutate()</code> and <code>filter()</code>.</p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.5 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>    <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3"></a>    <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">365</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>    <span class="fu">filter</span>(arr_delay <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5"></a>    <span class="fu">mutate</span>(<span class="at">prop_delay =</span> arr_delay <span class="sc">/</span> <span class="fu">sum</span>(arr_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>    <span class="fu">select</span>(year<span class="sc">:</span>day, dest, arr_delay, prop_delay)</span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="co">#&gt; # A tibble: 131,106 × 6</span></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="co">#&gt; # Groups:   dest [77]</span></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="co">#&gt;     year month   day dest  arr_delay prop_delay</span></span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="co">#&gt;  1  2013     1     1 IAH          11  0.000111 </span></span>
<span id="cb31-12"><a href="#cb31-12"></a><span class="co">#&gt;  2  2013     1     1 IAH          20  0.000201 </span></span>
<span id="cb31-13"><a href="#cb31-13"></a><span class="co">#&gt;  3  2013     1     1 MIA          33  0.000235 </span></span>
<span id="cb31-14"><a href="#cb31-14"></a><span class="co">#&gt;  4  2013     1     1 ORD          12  0.0000424</span></span>
<span id="cb31-15"><a href="#cb31-15"></a><span class="co">#&gt;  5  2013     1     1 FLL          19  0.0000938</span></span>
<span id="cb31-16"><a href="#cb31-16"></a><span class="co">#&gt;  6  2013     1     1 ORD           8  0.0000283</span></span>
<span id="cb31-17"><a href="#cb31-17"></a><span class="co">#&gt;  7  2013     1     1 LAX           7  0.0000344</span></span>
<span id="cb31-18"><a href="#cb31-18"></a><span class="co">#&gt;  8  2013     1     1 DFW          31  0.000282 </span></span>
<span id="cb31-19"><a href="#cb31-19"></a><span class="co">#&gt;  9  2013     1     1 ATL          12  0.0000400</span></span>
<span id="cb31-20"><a href="#cb31-20"></a><span class="co">#&gt; 10  2013     1     1 DTW          16  0.000116 </span></span>
<span id="cb31-21"><a href="#cb31-21"></a><span class="co">#&gt; # … with 131,096 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We already use it in the above examples. This is to compute the number of observations in the current group. This function is implemented specifically for each data source and can only be used from within <code>summarise()</code>, <code>mutate()</code> and <code>filter()</code>.</p>
</div>
</div>
</section>
</section>
<section id="ggplot2" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="ggplot2"><span class="header-section-number">8.4</span> <code>ggplot2</code></h2>
<p>This is the graphing package for R in <code>tidyverse</code>. <code>ggplot2</code> implements the <em>grammar of graphics</em>, a coherent system for describing and building graphs. With <code>ggplot2</code>, you can do more faster by learning one system and applying it in many places. The main function is <code>ggplot()</code>.</p>
<p><code>ggplot2</code> will be uploaded with <code>tidyverse</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use the dataset <code>mpg</code> as the example. This dataset comes with <code>ggplot2</code>. Once you load <code>ggplot2</code> you can directly find the dataset by typing <code>mpg</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>mpg</span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co">#&gt; # A tibble: 234 × 11</span></span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="co">#&gt;    manufacturer model      displ  year   cyl trans drv     cty   hwy fl    class</span></span>
<span id="cb33-4"><a href="#cb33-4"></a><span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="co">#&gt;  1 audi         a4           1.8  1999     4 auto… f        18    29 p     comp…</span></span>
<span id="cb33-6"><a href="#cb33-6"></a><span class="co">#&gt;  2 audi         a4           1.8  1999     4 manu… f        21    29 p     comp…</span></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="co">#&gt;  3 audi         a4           2    2008     4 manu… f        20    31 p     comp…</span></span>
<span id="cb33-8"><a href="#cb33-8"></a><span class="co">#&gt;  4 audi         a4           2    2008     4 auto… f        21    30 p     comp…</span></span>
<span id="cb33-9"><a href="#cb33-9"></a><span class="co">#&gt;  5 audi         a4           2.8  1999     6 auto… f        16    26 p     comp…</span></span>
<span id="cb33-10"><a href="#cb33-10"></a><span class="co">#&gt;  6 audi         a4           2.8  1999     6 manu… f        18    26 p     comp…</span></span>
<span id="cb33-11"><a href="#cb33-11"></a><span class="co">#&gt;  7 audi         a4           3.1  2008     6 auto… f        18    27 p     comp…</span></span>
<span id="cb33-12"><a href="#cb33-12"></a><span class="co">#&gt;  8 audi         a4 quattro   1.8  1999     4 manu… 4        18    26 p     comp…</span></span>
<span id="cb33-13"><a href="#cb33-13"></a><span class="co">#&gt;  9 audi         a4 quattro   1.8  1999     4 auto… 4        16    25 p     comp…</span></span>
<span id="cb33-14"><a href="#cb33-14"></a><span class="co">#&gt; 10 audi         a4 quattro   2    2008     4 manu… 4        20    28 p     comp…</span></span>
<span id="cb33-15"><a href="#cb33-15"></a><span class="co">#&gt; # … with 224 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The syntax for <code>ggplot()</code> is ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="sc">&lt;</span>DATA<span class="sc">&gt;</span>) <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>    <span class="er">&lt;</span>GEOM_FUNCTION<span class="sc">&gt;</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="sc">&lt;</span>MAPPINGS<span class="sc">&gt;</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
<p><code>ggplot(data=&lt;DATA&gt;)</code> create a plot without any geometric elements. It simply creates the canvas paired with the dataset.</p>
<p>Then you add one or more layers to <code>ggplot()</code> to complete the graph. The function <code>&lt;GEOM_FUNCTION&gt;(mapping = aes(&lt;MAPPINGS&gt;))</code> adds a layer to the plot. You may add as many layers as you want.</p>
<p>Each <code>geom</code> function takes a <code>mapping</code> argument. This defines how variables in the dataset are mapped to visual properties. <code>mapping</code> is always paired with <code>aes(x=, y=)</code>. This</p>
<p>Here is a quick example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="aesthetic-mappings" class="level3" data-number="8.4.1">
<h3 data-number="8.4.1" class="anchored" data-anchor-id="aesthetic-mappings"><span class="header-section-number">8.4.1</span> Aesthetic mappings</h3>
<p>An <em>aesthetic</em> is a visual property of the objects in your plot. It include things like the size, the shape or the color of the points. The variables set in <code>aes()</code> will change the aesthetic apperance of the geometric objects according to the variables. If the variables are set outside <code>aes()</code>, the apperance will be fixed. Please see the following examples.</p>
<p>Note that the variables in <code>aes()</code> other than <code>x</code> and <code>y</code> will automatically get legends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy), <span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">color =</span> class))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-37-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="facet" class="level3" data-number="8.4.2">
<h3 data-number="8.4.2" class="anchored" data-anchor-id="facet"><span class="header-section-number">8.4.2</span> <code>facet</code></h3>
<p>For categorical data, you can split the plot into <code>facets</code>. This <code>facet</code> function will be attached as a layer followed by a <code>+</code> sign.</p>
<ul>
<li>To facet your plot by a single variable, use <code>facet_wrap()</code>. The first argument should be a formula, which you create with <code>~</code> followed by a variable name.</li>
<li>To facet your plot by two variables, use <code>facet_grid()</code>. The first argument is a formula which contains two variable names separated by a <code>~</code>.</li>
</ul>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.6 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> class, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>You may look at the variables to see the relations with the plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">unique</span>(mpg<span class="sc">$</span>class)</span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="co">#&gt; [1] "compact"    "midsize"    "suv"        "2seater"    "minivan"   </span></span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="co">#&gt; [6] "pickup"     "subcompact"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.7 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3"></a>    <span class="fu">facet_grid</span>(drv <span class="sc">~</span> cyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>You may look at the variables to see the relations with the plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="fu">unique</span>(mpg<span class="sc">$</span>drv)</span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="co">#&gt; [1] "f" "4" "r"</span></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="fu">unique</span>(mpg<span class="sc">$</span>cyl)</span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="co">#&gt; [1] 4 6 8 5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>~</code> symbol is used to define a <code>formula</code>. The <code>formula</code> is a R object, which provide the pattern of a “formula”. Therefore <code>drv~cyl</code> means that <code>drv</code> is a function of <code>cyl</code>.</p>
</div>
</div>
</section>
<section id="geom-objects" class="level3" data-number="8.4.3">
<h3 data-number="8.4.3" class="anchored" data-anchor-id="geom-objects"><span class="header-section-number">8.4.3</span> <code>geom</code> objects</h3>
<p>A <code>geom</code> is the geometrical object that a plot uses to represent data. When drawing plots, you just need to attach those geometrical objects to a <code>ggplot</code> canvas with <code>+</code> symbol. Some of the geometrical objects can automatically do statistical transformations. The statistical transformations is short for <code>stat</code>, and the <code>stat</code> argument in those <code>geom</code> will show which statistical transformations are applied.</p>
<ul>
<li><code>geom_point()</code> draws scatter plot.</li>
<li><code>geom_smooth()</code> draws smooth line approximation.</li>
<li><code>geom_bar()</code> draws bar plot.</li>
<li><code>geom_histogram()</code> draws histogram.</li>
</ul>
<p>The arguments can be written in <code>ggplot()</code>. All the later <code>geom</code> will get those arguments from <code>ggplot()</code>. If the arguments are written again in <code>geom</code> object, it will override the <code>ggplot()</code> arguments.</p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.8 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3"></a>    <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy), <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">method =</span> <span class="st">"loess"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-42-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a></span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3"></a>    <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">linetype =</span> drv), <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">method =</span> <span class="st">"loess"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-42-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy), <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">method =</span> <span class="st">"loess"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-42-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> class)) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4"></a>    <span class="fu">geom_smooth</span>(</span>
<span id="cb46-5"><a href="#cb46-5"></a>        <span class="at">data =</span> <span class="fu">filter</span>(mpg, class <span class="sc">==</span> <span class="st">"subcompact"</span>),</span>
<span id="cb46-6"><a href="#cb46-6"></a>        <span class="at">se =</span> <span class="cn">FALSE</span>, </span>
<span id="cb46-7"><a href="#cb46-7"></a>        <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">method =</span> <span class="st">"loess"</span></span>
<span id="cb46-8"><a href="#cb46-8"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-42-5.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</section>
</section>
<section id="examples" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="examples"><span class="header-section-number">8.5</span> Examples</h2>
<section id="who-tb-dataset" class="level3" data-number="8.5.1">
<h3 data-number="8.5.1" class="anchored" data-anchor-id="who-tb-dataset"><span class="header-section-number">8.5.1</span> WHO TB dataset</h3>
<p>Let us explore the tuberculosis cases data. The dataset is provided by WHO and can be downloaded from <a href="https://www.who.int/teams/global-tuberculosis-programme/data">here</a>. <code>tidyr</code> also provides the dataset. You may directly get the dataset after you load <code>tidyr</code> from <code>tidyverse</code>. The variable description can be found from <a href="https://tidyr.tidyverse.org/reference/who.html"><code>tidyr</code> documentations</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb47-2"><a href="#cb47-2"></a>who</span>
<span id="cb47-3"><a href="#cb47-3"></a><span class="co">#&gt; # A tibble: 7,240 × 60</span></span>
<span id="cb47-4"><a href="#cb47-4"></a><span class="co">#&gt;    country  iso2  iso3   year new_sp_m014 new_sp_m1524 new_sp_m2534 new_sp_m3544</span></span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;int&gt;       &lt;int&gt;        &lt;int&gt;        &lt;int&gt;        &lt;int&gt;</span></span>
<span id="cb47-6"><a href="#cb47-6"></a><span class="co">#&gt;  1 Afghani… AF    AFG    1980          NA           NA           NA           NA</span></span>
<span id="cb47-7"><a href="#cb47-7"></a><span class="co">#&gt;  2 Afghani… AF    AFG    1981          NA           NA           NA           NA</span></span>
<span id="cb47-8"><a href="#cb47-8"></a><span class="co">#&gt;  3 Afghani… AF    AFG    1982          NA           NA           NA           NA</span></span>
<span id="cb47-9"><a href="#cb47-9"></a><span class="co">#&gt;  4 Afghani… AF    AFG    1983          NA           NA           NA           NA</span></span>
<span id="cb47-10"><a href="#cb47-10"></a><span class="co">#&gt;  5 Afghani… AF    AFG    1984          NA           NA           NA           NA</span></span>
<span id="cb47-11"><a href="#cb47-11"></a><span class="co">#&gt;  6 Afghani… AF    AFG    1985          NA           NA           NA           NA</span></span>
<span id="cb47-12"><a href="#cb47-12"></a><span class="co">#&gt;  7 Afghani… AF    AFG    1986          NA           NA           NA           NA</span></span>
<span id="cb47-13"><a href="#cb47-13"></a><span class="co">#&gt;  8 Afghani… AF    AFG    1987          NA           NA           NA           NA</span></span>
<span id="cb47-14"><a href="#cb47-14"></a><span class="co">#&gt;  9 Afghani… AF    AFG    1988          NA           NA           NA           NA</span></span>
<span id="cb47-15"><a href="#cb47-15"></a><span class="co">#&gt; 10 Afghani… AF    AFG    1989          NA           NA           NA           NA</span></span>
<span id="cb47-16"><a href="#cb47-16"></a><span class="co">#&gt; # … with 7,230 more rows, and 52 more variables: new_sp_m4554 &lt;int&gt;,</span></span>
<span id="cb47-17"><a href="#cb47-17"></a><span class="co">#&gt; #   new_sp_m5564 &lt;int&gt;, new_sp_m65 &lt;int&gt;, new_sp_f014 &lt;int&gt;,</span></span>
<span id="cb47-18"><a href="#cb47-18"></a><span class="co">#&gt; #   new_sp_f1524 &lt;int&gt;, new_sp_f2534 &lt;int&gt;, new_sp_f3544 &lt;int&gt;,</span></span>
<span id="cb47-19"><a href="#cb47-19"></a><span class="co">#&gt; #   new_sp_f4554 &lt;int&gt;, new_sp_f5564 &lt;int&gt;, new_sp_f65 &lt;int&gt;,</span></span>
<span id="cb47-20"><a href="#cb47-20"></a><span class="co">#&gt; #   new_sn_m014 &lt;int&gt;, new_sn_m1524 &lt;int&gt;, new_sn_m2534 &lt;int&gt;,</span></span>
<span id="cb47-21"><a href="#cb47-21"></a><span class="co">#&gt; #   new_sn_m3544 &lt;int&gt;, new_sn_m4554 &lt;int&gt;, new_sn_m5564 &lt;int&gt;,</span></span>
<span id="cb47-22"><a href="#cb47-22"></a><span class="co">#&gt; #   new_sn_m65 &lt;int&gt;, new_sn_f014 &lt;int&gt;, new_sn_f1524 &lt;int&gt;, …</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Based on the description of varaibles, we understand that</p>
<ol type="1">
<li><code>country</code>, <code>iso2</code>, <code>iso3</code> are all refered to country names (and thus they are redundant).</li>
<li>Columns after <code>year</code>, like <code>new_sp_m014</code> etc., are counts of new TB cases recorded by groups. The code has three parts, most of which are separated by <code>_</code> (but there are some exceptions).
<ul>
<li>The first part is always <code>new</code>.</li>
<li>The second part is a code for method of diagnosis:
<ul>
<li><code>rel</code> = relapse,</li>
<li><code>sn</code> = negative pulmonary smear,</li>
<li><code>sp</code> = positive pulmonary smear,</li>
<li><code>ep</code> = extrapulmonary.</li>
</ul></li>
<li>The third part is a code for gender (<code>f</code> = female, <code>m</code> = male) and a code for age group:
<ul>
<li><code>014</code> = 0-14 yrs of age,</li>
<li><code>1524</code> = 15-24 years of age,</li>
<li><code>2534</code> = 25 to 34 years of age,</li>
<li><code>3544</code> = 35 to 44 years of age,</li>
<li><code>4554</code> = 45 to 54 years of age,</li>
<li><code>5564</code> = 55 to 64 years of age,</li>
<li><code>65</code> = 65 years of age or older</li>
</ul></li>
</ul></li>
</ol>
<p>Therefore to clean the data, we need the following steps.</p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.9 </strong></span>Gather together all the columns from <code>new_sp_m014</code> to <code>newrel_f65</code>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>wholonger <span class="ot">&lt;-</span> who <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="dv">5</span><span class="sc">:</span><span class="dv">60</span>, <span class="at">names_to=</span><span class="st">'group'</span>, <span class="at">values_to=</span><span class="st">'counts'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
<p>Then we use <code>stringr::str_replace()</code> to replace <code>newrel</code> by <code>new_rel</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>wholonger2 <span class="ot">&lt;-</span> wholonger <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">key=</span><span class="fu">str_replace</span>(group, <span class="st">'newrel'</span>, <span class="st">'new_rel'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.10 </strong></span>Parse the column <code>group</code> into columns.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>wholonger3 <span class="ot">&lt;-</span> wholonger2 <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2"></a>        <span class="fu">separate</span>(key, <span class="at">into=</span><span class="fu">c</span>(<span class="st">'new'</span>, <span class="st">'type'</span>, <span class="st">'genderage'</span>), <span class="at">sep=</span><span class="st">'_'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3"></a>        <span class="fu">separate</span>(genderage, <span class="at">into=</span><span class="fu">c</span>(<span class="st">'gender'</span>, <span class="st">'age'</span>), <span class="at">sep=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.11 </strong></span>Pick the columns that matters.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>tidywho <span class="ot">&lt;-</span> wholonger3[<span class="fu">c</span>(<span class="st">'country'</span>, <span class="st">'year'</span>, <span class="st">'type'</span>, <span class="st">'gender'</span>, <span class="st">'age'</span>, <span class="st">'counts'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
<p>We could use the pipe symbol to connect all the above steps.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>tidywho <span class="ot">&lt;-</span> who <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="dv">5</span><span class="sc">:</span><span class="dv">60</span>, <span class="at">names_to=</span><span class="st">'group'</span>, <span class="at">values_to=</span><span class="st">'counts'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href="#cb52-3"></a>    <span class="fu">mutate</span>(<span class="at">key=</span><span class="fu">str_replace</span>(group, <span class="st">'newrel'</span>, <span class="st">'new_rel'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-4"><a href="#cb52-4"></a>    <span class="fu">separate</span>(key, <span class="at">into=</span><span class="fu">c</span>(<span class="st">'new'</span>, <span class="st">'type'</span>, <span class="st">'genderage'</span>), <span class="at">sep=</span><span class="st">'_'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-5"><a href="#cb52-5"></a>    <span class="fu">separate</span>(genderage, <span class="at">into=</span><span class="fu">c</span>(<span class="st">'gender'</span>, <span class="st">'age'</span>), <span class="at">sep=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-6"><a href="#cb52-6"></a>    <span class="fu">select</span>(<span class="st">'country'</span>, <span class="st">'year'</span>, <span class="st">'type'</span>, <span class="st">'gender'</span>, <span class="st">'age'</span>, <span class="st">'counts'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="us-babynames" class="level3" data-number="8.5.2">
<h3 data-number="8.5.2" class="anchored" data-anchor-id="us-babynames"><span class="header-section-number">8.5.2</span> US Babynames</h3>
<p>Let us use R to solve the babynames dataset again.</p>
<p>The first task is to read those files.</p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.12 </strong></span>Please read files and put the data into one tibble. The dataset can be downloaded from <a href="assests/datasets/babynames.zip">here</a> as a zip file.</p>
<div class="cell">

</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>path <span class="ot">&lt;-</span> <span class="st">'assessts/datasets/babynames/yob'</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>dfs <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1880</span><span class="sc">:</span><span class="dv">2010</span>, <span class="cf">function</span>(y){</span>
<span id="cb53-3"><a href="#cb53-3"></a>    filepath <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path, <span class="fu">as.character</span>(y), <span class="st">'.txt'</span>)</span>
<span id="cb53-4"><a href="#cb53-4"></a>    df_individual <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="fu">read.csv</span>(filepath, <span class="at">header=</span><span class="cn">FALSE</span>))</span>
<span id="cb53-5"><a href="#cb53-5"></a>    <span class="fu">names</span>(df_individual) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'name'</span>, <span class="st">'gender'</span>, <span class="st">'counts'</span>)</span>
<span id="cb53-6"><a href="#cb53-6"></a>    df_individual<span class="sc">$</span>year <span class="ot">&lt;-</span> y</span>
<span id="cb53-7"><a href="#cb53-7"></a>    df_individual</span>
<span id="cb53-8"><a href="#cb53-8"></a>})</span>
<span id="cb53-9"><a href="#cb53-9"></a>df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(dfs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.13 </strong></span>Please plot the total births by gender and year.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2"></a>    <span class="fu">group_by</span>(gender, year) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="#cb54-3"></a>    <span class="fu">summarize</span>(<span class="at">total_num=</span><span class="fu">sum</span>(counts)) <span class="sc">%&gt;%</span> </span>
<span id="cb54-4"><a href="#cb54-4"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb54-5"><a href="#cb54-5"></a>        <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>total_num, <span class="at">color=</span>gender))</span>
<span id="cb54-6"><a href="#cb54-6"></a><span class="co">#&gt; `summarise()` has grouped output by 'gender'. You can override using the</span></span>
<span id="cb54-7"><a href="#cb54-7"></a><span class="co">#&gt; `.groups` argument.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.14 </strong></span>Please compute the proportions of each name relateive to the total number of births per year per gender.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2"></a>    <span class="fu">group_by</span>(gender, year) <span class="sc">%&gt;%</span> </span>
<span id="cb55-3"><a href="#cb55-3"></a>    <span class="fu">mutate</span>(<span class="at">prop=</span>counts<span class="sc">/</span><span class="fu">sum</span>(counts))</span>
<span id="cb55-4"><a href="#cb55-4"></a><span class="co">#&gt; # A tibble: 1,690,784 × 5</span></span>
<span id="cb55-5"><a href="#cb55-5"></a><span class="co">#&gt; # Groups:   gender, year [262]</span></span>
<span id="cb55-6"><a href="#cb55-6"></a><span class="co">#&gt;    name      gender counts  year   prop</span></span>
<span id="cb55-7"><a href="#cb55-7"></a><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;</span></span>
<span id="cb55-8"><a href="#cb55-8"></a><span class="co">#&gt;  1 Mary      F        7065  1880 0.0776</span></span>
<span id="cb55-9"><a href="#cb55-9"></a><span class="co">#&gt;  2 Anna      F        2604  1880 0.0286</span></span>
<span id="cb55-10"><a href="#cb55-10"></a><span class="co">#&gt;  3 Emma      F        2003  1880 0.0220</span></span>
<span id="cb55-11"><a href="#cb55-11"></a><span class="co">#&gt;  4 Elizabeth F        1939  1880 0.0213</span></span>
<span id="cb55-12"><a href="#cb55-12"></a><span class="co">#&gt;  5 Minnie    F        1746  1880 0.0192</span></span>
<span id="cb55-13"><a href="#cb55-13"></a><span class="co">#&gt;  6 Margaret  F        1578  1880 0.0173</span></span>
<span id="cb55-14"><a href="#cb55-14"></a><span class="co">#&gt;  7 Ida       F        1472  1880 0.0162</span></span>
<span id="cb55-15"><a href="#cb55-15"></a><span class="co">#&gt;  8 Alice     F        1414  1880 0.0155</span></span>
<span id="cb55-16"><a href="#cb55-16"></a><span class="co">#&gt;  9 Bertha    F        1320  1880 0.0145</span></span>
<span id="cb55-17"><a href="#cb55-17"></a><span class="co">#&gt; 10 Sarah     F        1288  1880 0.0142</span></span>
<span id="cb55-18"><a href="#cb55-18"></a><span class="co">#&gt; # … with 1,690,774 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.15 </strong></span>We would like to keep the first 100 names (by counts) in each year and save it as a new tibble <code>top100</code>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>top100 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2"></a>        <span class="fu">group_by</span>(gender, year) <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="#cb56-3"></a>        <span class="fu">top_n</span>(<span class="dv">100</span>, <span class="at">wt=</span>counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.16 </strong></span>Please draw the trend of <code>John</code>, <code>Harry</code>, <code>Mary</code> in <code>top100</code> by counts.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>namelist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'John'</span>, <span class="st">'Harry'</span>, <span class="st">'Mary'</span>)</span>
<span id="cb57-2"><a href="#cb57-2"></a>top100 <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3"></a>    <span class="fu">filter</span>(name <span class="sc">%in%</span> namelist) <span class="sc">%&gt;%</span> </span>
<span id="cb57-4"><a href="#cb57-4"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-5"><a href="#cb57-5"></a>        <span class="fu">geom_line</span>(<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>counts, <span class="at">color=</span>name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.17 </strong></span>Now we would like to analyze the ending of names. Please get a <code>tibble</code> that contains the counts of ending letter per year per gender. We mainly focus on 1910, 1960 and 2010.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2"></a>    <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1910</span>, <span class="dv">1960</span>, <span class="dv">2010</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href="#cb58-3"></a>    <span class="fu">mutate</span>(<span class="at">ending=</span><span class="fu">str_sub</span>(name, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb58-4"><a href="#cb58-4"></a>    <span class="fu">group_by</span>(gender, year, ending) <span class="sc">%&gt;%</span> </span>
<span id="cb58-5"><a href="#cb58-5"></a>    <span class="fu">summarise</span>(<span class="at">ending_counts=</span><span class="fu">sum</span>(counts)) <span class="sc">%&gt;%</span> </span>
<span id="cb58-6"><a href="#cb58-6"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7"></a>        <span class="fu">geom_bar</span>(</span>
<span id="cb58-8"><a href="#cb58-8"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb58-9"><a href="#cb58-9"></a>                <span class="at">x=</span>ending, </span>
<span id="cb58-10"><a href="#cb58-10"></a>                <span class="at">y=</span>ending_counts, </span>
<span id="cb58-11"><a href="#cb58-11"></a>                <span class="at">fill=</span>year,</span>
<span id="cb58-12"><a href="#cb58-12"></a>                <span class="at">group=</span>year</span>
<span id="cb58-13"><a href="#cb58-13"></a>                ), </span>
<span id="cb58-14"><a href="#cb58-14"></a>            <span class="at">stat =</span> <span class="st">"identity"</span>, </span>
<span id="cb58-15"><a href="#cb58-15"></a>            <span class="at">position =</span> <span class="st">"dodge"</span>,</span>
<span id="cb58-16"><a href="#cb58-16"></a>        ) <span class="sc">+</span></span>
<span id="cb58-17"><a href="#cb58-17"></a>        <span class="fu">facet_wrap</span>(<span class="sc">~</span>gender, <span class="at">nrow=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.18 </strong></span>Please draw the line plot to show the trending of certain letters through years. Here we choose <code>d</code>, <code>n</code> and <code>y</code>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2"></a>    <span class="fu">mutate</span>(<span class="at">ending=</span><span class="fu">str_sub</span>(name, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3"></a>    <span class="fu">group_by</span>(year, ending) <span class="sc">%&gt;%</span> </span>
<span id="cb59-4"><a href="#cb59-4"></a>    <span class="fu">summarise</span>(<span class="at">ending_counts=</span><span class="fu">sum</span>(counts)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-5"><a href="#cb59-5"></a>    <span class="fu">filter</span>(ending <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'d'</span>, <span class="st">'n'</span>, <span class="st">'y'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-6"><a href="#cb59-6"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb59-7"><a href="#cb59-7"></a>        <span class="fu">geom_line</span>(</span>
<span id="cb59-8"><a href="#cb59-8"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb59-9"><a href="#cb59-9"></a>                <span class="at">x=</span>year, </span>
<span id="cb59-10"><a href="#cb59-10"></a>                <span class="at">y=</span>ending_counts, </span>
<span id="cb59-11"><a href="#cb59-11"></a>                <span class="at">color=</span>ending</span>
<span id="cb59-12"><a href="#cb59-12"></a>            )</span>
<span id="cb59-13"><a href="#cb59-13"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="exercises" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="exercises"><span class="header-section-number">8.6</span> Exercises</h2>
<div id="exr-" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 8.1 </strong></span>How can you tell if an object is a tibble?</p>
</div>
<div id="exr-" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 8.2 </strong></span>Compare and contrast the following operations on a <code>data.frame</code> and equivalent <code>tibble</code>. What is different? Why might the default data frame behaviors cause you frustration?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">abc =</span> <span class="dv">1</span>, <span class="at">xyz =</span> <span class="st">"a"</span>)</span>
<span id="cb60-2"><a href="#cb60-2"></a>df<span class="sc">$</span>x</span>
<span id="cb60-3"><a href="#cb60-3"></a>df[, <span class="st">"xyz"</span>]</span>
<span id="cb60-4"><a href="#cb60-4"></a>df[, <span class="fu">c</span>(<span class="st">"abc"</span>, <span class="st">"xyz"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="exr-" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 8.3 </strong></span>If you have the name of a variable stored in an object, e.g., <code>var &lt;- "xyz"</code>, how can you extract the reference variable from a tibble? You may use the following codes to get a tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">abc =</span> <span class="dv">1</span>, <span class="at">xyz =</span> <span class="st">"a"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="exr-" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 8.4 </strong></span>Practice referring to nonsyntactic names in the following data.frame by:</p>
<ol type="a">
<li>Extracting the variable called 1.</li>
<li>Creating a new column called 3, which is 2 divided by 1.</li>
<li>Renaming the columns to one, two, and three:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>annoying <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb62-3"><a href="#cb62-3"></a><span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span>))</span>
<span id="cb62-4"><a href="#cb62-4"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="exr-" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 8.5 </strong></span>Both <code>unite()</code> and <code>separate()</code> have a <code>remove</code> argument. What does it do? Why would you set it to <code>FALSE</code>?</p>
</div>
<div id="exr-" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 8.6 </strong></span>Use <code>flights</code> dataset. Currently <code>dep_time</code> and <code>sched_dep_time</code> are convenient to look at, but hard to compute with because they’re not really continuous numbers. Convert them to a more convenient representation of number of minutes since midnight.</p>
</div>
</section>
<section id="projects" class="level2" data-number="8.7">
<h2 data-number="8.7" class="anchored" data-anchor-id="projects"><span class="header-section-number">8.7</span> Projects</h2>
<div class="cell">

</div>
<!-- 
::: {#exr-}
This is a Python question. Please download the datasets from here. It is the same datasets as in @exm-tidydatasets. Please use Python to make `
::: -->
<!-- 
::: {#exr-}
Why are `gather()` and `spread()` not perfectly symmetrical? Carefully consider the following example:


::: {.cell}

```{.r .cell-code}
stocks <- tibble(
    year = c(2015, 2015, 2016, 2016),
    half = c( 1, 2, 1, 2),
    return = c(1.88, 0.59, 0.92, 0.17)
)
stocks %>%
    spread(year, return) %>%
    gather("year", "return", `2015`:`2016`)
#> # A tibble: 4 × 3
#>    half year  return
#>   <dbl> <chr>  <dbl>
#> 1     1 2015    1.88
#> 2     2 2015    0.59
#> 3     1 2016    0.92
#> 4     2 2016    0.17
```
:::
(Hint: look at the variable types and think about column `names`.)

Both `spread()` and `gather()` have a `convert` argument. What does it do?
::: -->

<!-- 

::: {#exr-}
Why does this code fail?
::: {.cell}

```{.r .cell-code}
table4a %>%
    gather(1999, 2000, key = "year", value = "cases")
#> Error in `loc_validate()`:
#> ! Can't subset columns past the end.
#> ℹ Locations 1999 and 2000 don't exist.
#> ℹ There are only 3 columns.
```
:::

::: -->
<div id="exr-" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 8.7 </strong></span>Please make the following data tidy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb63-2"><a href="#cb63-2"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Day=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">`</span><span class="at">Plant_A_Height (cm)</span><span class="st">`</span><span class="ot">=</span><span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.9</span>, <span class="fl">1.3</span>, <span class="fl">1.8</span>), <span class="st">`</span><span class="at">Plant_B_Height (cm)</span><span class="st">`</span><span class="ot">=</span><span class="fu">c</span>(<span class="fl">0.7</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="fl">1.8</span>, <span class="fl">2.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="exr-" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 8.8 </strong></span>Please use the <code>flights</code> dataset. Please find all flights that :</p>
<ol type="1">
<li>Had an arrival delay of two or more hours.</li>
<li>Flew to <code>IAH</code> or <code>HOU</code>.</li>
<li>Were operated by <code>United</code>, <code>American</code> or <code>Delta</code>.</li>
<li>Departed in summer (July, August, and September).</li>
<li>Arrived more than two hours late, but didn’t leave late.</li>
<li>Were delayed by at least an hour, but made up over 30 minutes in flight.</li>
<li>Departed between midnight and 6 a.m. (inclusive).</li>
</ol>
</div>
<div id="exr-" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 8.9 </strong></span>Re-create the R code necessary to generate the following graphs. The dataset is <code>mpg</code>.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-64-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="08-_files/figure-html/unnamed-chunk-64-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body" role="doc-bibliography" style="display: none">
<div id="ref-Wic2017" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline"><span class="smallcaps">Wickham</span>, H. and <span class="smallcaps">Grolemund</span>, G. (2017). <em><a href="https://r4ds.had.co.nz/">R for data science: Import, tidy, transform, visualize, and model data</a></em>. O’Reilly Media.</div>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../contents/7/07-.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">R Fundamentals</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../contents/references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>